"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _signature = require("@verdaccio/signature");
var _utils = require("@verdaccio/utils");
var _pluginLoader = _interopRequireDefault(require("../lib/plugin-loader"));
var _authUtils = require("./auth-utils");
var _constants = require("./constants");
var _logger = require("./logger");
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const debug = (0, _debug.default)('verdaccio:auth');
class Auth {
  constructor(config) {
    this.config = config;
    this.logger = _logger.logger;
    this.secret = config.secret;
    this.plugins = this._loadPlugin(config);
    this._applyDefaultPlugins();
  }
  _loadPlugin(config) {
    const pluginOptions = {
      config,
      logger: this.logger
    };
    let authConf = _objectSpread({}, config.auth);
    if (authConf !== null && authConf !== void 0 && authConf.htpasswd) {
      // special case for htpasswd plugin, the v6 version uses bcrypt by default
      // 5.x enforces crypt to avoid breaking changes, but is highly recommended using
      // bcrypt instead.
      if (!authConf.htpasswd.algorithm) {
        authConf.htpasswd.algorithm = 'crypt';
        this.logger.info(
        // eslint-disable-next-line max-len
        'the "crypt" algorithm is deprecated consider switch to "bcrypt" in the configuration file. Read the documentation for additional details');
      }
    }
    return (0, _pluginLoader.default)(config, authConf, pluginOptions, plugin => {
      const {
        authenticate,
        allow_access,
        allow_publish
      } = plugin;
      // @ts-ignore
      return authenticate || allow_access || allow_publish;
    });
  }
  _applyDefaultPlugins() {
    this.plugins.push((0, _authUtils.getDefaultPlugins)(this.logger));
  }
  changePassword(username, password,
  // pragma: allowlist secret
  newPassword,
  // pragma: allowlist secret
  cb) {
    const validPlugins = _lodash.default.filter(this.plugins, plugin => _lodash.default.isFunction(plugin.changePassword));
    if (_lodash.default.isEmpty(validPlugins)) {
      return cb(_utils2.ErrorCode.getInternalError(_constants.SUPPORT_ERRORS.PLUGIN_MISSING_INTERFACE));
    }
    for (const plugin of validPlugins) {
      if (_lodash.default.isNil(plugin) || _lodash.default.isFunction(plugin.changePassword) === false) {
        debug('auth plugin does not implement changePassword, trying next one');
        continue;
      } else {
        debug('updating password for %o', username);
        plugin.changePassword(username, password, newPassword, (err, profile) => {
          if (err) {
            this.logger.error({
              username,
              err
            }, `An error has been produced
            updating the password for @{username}. Error: @{err.message}`);
            return cb(err);
          }
          this.logger.info({
            username
          }, 'updated password for @{username} was successful');
          return cb(null, profile);
        });
      }
    }
  }
  authenticate(username, password, cb) {
    const plugins = this.plugins.slice(0);
    const self = this;
    (function next() {
      const plugin = plugins.shift();
      if (_lodash.default.isFunction(plugin.authenticate) === false) {
        return next();
      }
      debug('authenticating %o', username);
      plugin.authenticate(username, password, function (err, groups) {
        if (err) {
          self.logger.error({
            username,
            err
          }, 'authenticating for user @{username} failed. Error: @{err.message}');
          return cb(err);
        }

        // Expect: SKIP if groups is falsey and not an array
        //         with at least one item (truthy length)
        // Expect: CONTINUE otherwise (will error if groups is not
        //         an array, but this is current behavior)
        // Caveat: STRING (if valid) will pass successfully
        //         bug give unexpected results
        // Info: Cannot use `== false to check falsey values`
        if (!!groups && groups.length !== 0) {
          // TODO: create a better understanding of expectations
          if (_lodash.default.isString(groups)) {
            throw new TypeError('plugin group error: invalid type for function');
          }
          const isGroupValid = _lodash.default.isArray(groups);
          if (!isGroupValid) {
            throw new TypeError(_constants.API_ERROR.BAD_FORMAT_USER_GROUP);
          }
          debug('authentication for user %o was successfully. Groups: %o', username, groups);
          return cb(err, (0, _config.createRemoteUser)(username, groups));
        }
        next();
      });
    })();
  }
  add_user(user, password, cb) {
    const self = this;
    const plugins = this.plugins.slice(0);
    debug('add user %o', user);
    (function next() {
      const plugin = plugins.shift();
      let method = 'adduser';
      if (_lodash.default.isFunction(plugin[method]) === false) {
        method = 'add_user';
        self.logger.warn('the plugin method add_user in the auth plugin is deprecated and will be removed in next major release, notify to the plugin author');
      }
      if (_lodash.default.isFunction(plugin[method]) === false) {
        next();
      } else {
        // p.add_user() execution
        plugin[method](user, password, function (err, ok) {
          if (err) {
            self.logger.error({
              user,
              err: err.message
            }, 'the user @{user} could not being added. Error: @{err}');
            return cb(err);
          }
          if (ok) {
            self.logger.info({
              user
            }, 'the user @{user} has been added');
            return self.authenticate(user, password, cb);
          }
          next();
        });
      }
    })();
  }

  /**
   * Allow user to access a package.
   */
  allow_access({
    packageName,
    packageVersion
  }, user, callback) {
    const plugins = this.plugins.slice(0);
    const self = this;
    const pkgAllowAcces = {
      name: packageName,
      version: packageVersion
    };
    const pkg = Object.assign({}, pkgAllowAcces, (0, _utils.getMatchedPackagesSpec)(packageName, this.config.packages));
    debug('allow access for %o', packageName);
    (function next() {
      const plugin = plugins.shift();
      if (_lodash.default.isNil(plugin) || _lodash.default.isFunction(plugin.allow_access) === false) {
        return next();
      }
      plugin.allow_access(user, pkg, function (err, ok) {
        if (err) {
          self.logger.error({
            packageName,
            err
          }, 'forbidden access for @{packageName}. Error: @{err.message}');
          return callback(err);
        }
        if (ok) {
          self.logger.info({
            packageName
          }, 'allowed access for @{packageName}');
          return callback(null, ok);
        }
        next(); // cb(null, false) causes next plugin to roll
      });
    })();
  }

  allow_unpublish({
    packageName,
    packageVersion
  }, user, callback) {
    const pkg = Object.assign({
      name: packageName,
      version: packageVersion
    }, (0, _utils.getMatchedPackagesSpec)(packageName, this.config.packages));
    debug('allow unpublish for %o', packageName);
    for (const plugin of this.plugins) {
      if (_lodash.default.isNil(plugin) || _lodash.default.isFunction(plugin.allow_unpublish) === false) {
        debug('allow unpublish for %o plugin does not implement allow_unpublish', packageName);
        continue;
      } else {
        // @ts-ignore
        plugin.allow_unpublish(user, pkg, (err, ok) => {
          if (err) {
            this.logger.error({
              packageName,
              user: user === null || user === void 0 ? void 0 : user.name
            }, '@{user} forbidden publish for @{packageName}, it will fallback on unpublish permissions');
            return callback(err);
          }
          if (_lodash.default.isNil(ok) === true) {
            debug('we bypass unpublish for %o, publish will handle the access', packageName);
            // @ts-ignore
            // eslint-disable-next-line
            return this.allow_publish(...arguments);
          }
          if (ok) {
            this.logger.info({
              packageName,
              user: user === null || user === void 0 ? void 0 : user.name
            }, '@{user} allowed unpublish for @{packageName}');
            return callback(null, ok);
          }
        });
      }
    }
  }

  /**
   * Allow user to publish a package.
   */
  allow_publish({
    packageName,
    packageVersion
  }, user, callback) {
    const plugins = this.plugins.slice(0);
    const self = this;
    const pkg = Object.assign({
      name: packageName,
      version: packageVersion
    }, (0, _utils.getMatchedPackagesSpec)(packageName, this.config.packages));
    debug('allow publish for %o init | plugins: %o', packageName, plugins);
    (function next() {
      const plugin = plugins.shift();
      if (_lodash.default.isNil(plugin) || _lodash.default.isFunction(plugin.allow_publish) === false) {
        debug('allow publish for %o plugin does not implement allow_publish', packageName);
        return next();
      }

      // @ts-ignore
      plugin.allow_publish(user, pkg, (err, ok) => {
        if (_lodash.default.isNil(err) === false && _lodash.default.isError(err)) {
          self.logger.error({
            packageName,
            user: user === null || user === void 0 ? void 0 : user.name
          }, '@{user} is forbidden publish for @{packageName}');
          return callback(err);
        }
        if (ok) {
          self.logger.info({
            packageName,
            user: user === null || user === void 0 ? void 0 : user.name
          }, '@{user} is allowed publish for @{packageName}');
          return callback(null, ok);
        }
        debug('allow publish skip validation for %o', packageName);
        next(); // cb(null, false) causes next plugin to roll
      });
    })();
  }

  apiJWTmiddleware() {
    const plugins = this.plugins.slice(0);
    const helpers = {
      createAnonymousRemoteUser: _config.createAnonymousRemoteUser,
      createRemoteUser: _config.createRemoteUser
    };
    for (const plugin of plugins) {
      if (plugin.apiJWTmiddleware) {
        return plugin.apiJWTmiddleware(helpers);
      }
    }
    return (req, res, _next) => {
      req.pause();
      const next = function (err) {
        req.resume();
        // uncomment this to reject users with bad auth headers
        // return _next.apply(null, arguments)
        // swallow error, user remains unauthorized
        // set remoteUserError to indicate that user was attempting authentication
        if (err) {
          req.remote_user.error = err.message;
        }
        return _next();
      };
      if (this._isRemoteUserValid(req.remote_user)) {
        // @ts-ignore
        return next();
      }

      // in case auth header does not exist we return anonymous function
      req.remote_user = (0, _config.createAnonymousRemoteUser)();
      const {
        authorization
      } = req.headers;
      if (_lodash.default.isNil(authorization)) {
        // @ts-ignore
        return next();
      }
      if (!(0, _authUtils.isAuthHeaderValid)(authorization)) {
        debug('api middleware auth heather is not valid');
        return next(_utils2.ErrorCode.getBadRequest(_constants.API_ERROR.BAD_AUTH_HEADER));
      }
      const security = (0, _authUtils.getSecurity)(this.config);
      const {
        secret
      } = this.config;
      if ((0, _authUtils.isAESLegacy)(security)) {
        debug('api middleware using legacy auth token');
        this._handleAESMiddleware(req, security, secret, authorization, next);
      } else {
        debug('api middleware using JWT auth token');
        this._handleJWTAPIMiddleware(req, security, secret, authorization, next);
      }
    };
  }
  _handleJWTAPIMiddleware(req, security, secret, authorization, next) {
    const {
      scheme,
      token
    } = (0, _authUtils.parseAuthTokenHeader)(authorization);
    if (scheme.toUpperCase() === _constants.TOKEN_BASIC.toUpperCase()) {
      // this should happen when client tries to login with an existing user
      const credentials = (0, _utils2.convertPayloadToBase64)(token).toString();
      const {
        user,
        password
      } = (0, _authUtils.parseBasicPayload)(credentials);
      this.authenticate(user, password, (err, user) => {
        if (!err) {
          req.remote_user = user;
          next();
        } else {
          req.remote_user = (0, _config.createAnonymousRemoteUser)();
          next(err);
        }
      });
    } else {
      // jwt handler
      const credentials = (0, _authUtils.getMiddlewareCredentials)(security, secret, authorization);
      if (credentials) {
        // if the signature is valid we rely on it
        req.remote_user = credentials;
        next();
      } else {
        // with JWT throw 401
        next(_utils2.ErrorCode.getForbidden(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
      }
    }
  }
  _handleAESMiddleware(req, security, secret, authorization, next) {
    const credentials = (0, _authUtils.getMiddlewareCredentials)(security, secret, authorization);
    if (credentials) {
      const {
        user,
        password
      } = credentials;
      this.authenticate(user, password, (err, user) => {
        if (!err) {
          req.remote_user = user;
          next();
        } else {
          req.remote_user = (0, _config.createAnonymousRemoteUser)();
          next(err);
        }
      });
    } else {
      // we force npm client to ask again with basic authentication
      return next(_utils2.ErrorCode.getBadRequest(_constants.API_ERROR.BAD_AUTH_HEADER));
    }
  }
  _isRemoteUserValid(remote_user) {
    return _lodash.default.isUndefined(remote_user) === false && _lodash.default.isUndefined(remote_user.name) === false;
  }

  /**
   * JWT middleware for WebUI
   */
  webUIJWTmiddleware() {
    return (req, res, _next) => {
      if (this._isRemoteUserValid(req.remote_user)) {
        return _next();
      }
      req.pause();
      const next = err => {
        req.resume();
        if (err) {
          // req.remote_user.error = err.message;
          res.status(err.statusCode).send(err.message);
        }
        return _next();
      };
      const {
        authorization
      } = req.headers;
      if (_lodash.default.isNil(authorization)) {
        // @ts-ignore
        return next();
      }
      if (!(0, _authUtils.isAuthHeaderValid)(authorization)) {
        return next(_utils2.ErrorCode.getBadRequest(_constants.API_ERROR.BAD_AUTH_HEADER));
      }
      const token = (authorization || '').replace(`${_constants.TOKEN_BEARER} `, '');
      if (!token) {
        // @ts-ignore
        return next();
      }
      let credentials;
      try {
        credentials = (0, _authUtils.verifyJWTPayload)(token, this.config.secret);
      } catch (err) {
        // FIXME: intended behaviour, do we want it?
      }
      if (this._isRemoteUserValid(credentials)) {
        const {
          name,
          groups
        } = credentials;
        req.remote_user = (0, _config.createRemoteUser)(name, groups);
      } else {
        req.remote_user = (0, _config.createAnonymousRemoteUser)();
      }
      // @ts-ignore
      next();
    };
  }
  async jwtEncrypt(user, signOptions) {
    const {
      real_groups,
      name,
      groups
    } = user;
    const realGroupsValidated = _lodash.default.isNil(real_groups) ? [] : real_groups;
    const groupedGroups = _lodash.default.isNil(groups) ? real_groups : Array.from(new Set([...groups.concat(realGroupsValidated)]));
    const payload = {
      real_groups: realGroupsValidated,
      name,
      groups: groupedGroups
    };
    const token = await (0, _signature.signPayload)(payload, this.secret, signOptions);
    return token;
  }

  /**
   * Encrypt a string.
   */
  aesEncrypt(buf) {
    return (0, _signature.aesEncryptDeprecated)(buf, this.secret);
  }
}
var _default = Auth;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZGVidWciLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9sb2Rhc2giLCJfY29uZmlnIiwiX3NpZ25hdHVyZSIsIl91dGlscyIsIl9wbHVnaW5Mb2FkZXIiLCJfYXV0aFV0aWxzIiwiX2NvbnN0YW50cyIsIl9sb2dnZXIiLCJfdXRpbHMyIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJvd25LZXlzIiwib2JqZWN0IiwiZW51bWVyYWJsZU9ubHkiLCJrZXlzIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwic3ltYm9scyIsImZpbHRlciIsInN5bSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImZvckVhY2giLCJrZXkiLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsImRlYnVnIiwiYnVpbGREZWJ1ZyIsIkF1dGgiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImxvZ2dlciIsInNlY3JldCIsInBsdWdpbnMiLCJfbG9hZFBsdWdpbiIsIl9hcHBseURlZmF1bHRQbHVnaW5zIiwicGx1Z2luT3B0aW9ucyIsImF1dGhDb25mIiwiYXV0aCIsImh0cGFzc3dkIiwiYWxnb3JpdGhtIiwiaW5mbyIsImxvYWRQbHVnaW4iLCJwbHVnaW4iLCJhdXRoZW50aWNhdGUiLCJhbGxvd19hY2Nlc3MiLCJhbGxvd19wdWJsaXNoIiwiZ2V0RGVmYXVsdFBsdWdpbnMiLCJjaGFuZ2VQYXNzd29yZCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsImNiIiwidmFsaWRQbHVnaW5zIiwiXyIsImlzRnVuY3Rpb24iLCJpc0VtcHR5IiwiRXJyb3JDb2RlIiwiZ2V0SW50ZXJuYWxFcnJvciIsIlNVUFBPUlRfRVJST1JTIiwiUExVR0lOX01JU1NJTkdfSU5URVJGQUNFIiwiaXNOaWwiLCJlcnIiLCJwcm9maWxlIiwiZXJyb3IiLCJzbGljZSIsInNlbGYiLCJuZXh0Iiwic2hpZnQiLCJncm91cHMiLCJpc1N0cmluZyIsImlzR3JvdXBWYWxpZCIsImlzQXJyYXkiLCJBUElfRVJST1IiLCJCQURfRk9STUFUX1VTRVJfR1JPVVAiLCJjcmVhdGVSZW1vdGVVc2VyIiwiYWRkX3VzZXIiLCJ1c2VyIiwibWV0aG9kIiwid2FybiIsIm9rIiwibWVzc2FnZSIsInBhY2thZ2VOYW1lIiwicGFja2FnZVZlcnNpb24iLCJjYWxsYmFjayIsInBrZ0FsbG93QWNjZXMiLCJuYW1lIiwidmVyc2lvbiIsInBrZyIsImFzc2lnbiIsImdldE1hdGNoZWRQYWNrYWdlc1NwZWMiLCJwYWNrYWdlcyIsImFsbG93X3VucHVibGlzaCIsImlzRXJyb3IiLCJhcGlKV1RtaWRkbGV3YXJlIiwiaGVscGVycyIsImNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIiLCJyZXEiLCJfbmV4dCIsInBhdXNlIiwicmVzdW1lIiwicmVtb3RlX3VzZXIiLCJfaXNSZW1vdGVVc2VyVmFsaWQiLCJhdXRob3JpemF0aW9uIiwiaGVhZGVycyIsImlzQXV0aEhlYWRlclZhbGlkIiwiZ2V0QmFkUmVxdWVzdCIsIkJBRF9BVVRIX0hFQURFUiIsInNlY3VyaXR5IiwiZ2V0U2VjdXJpdHkiLCJpc0FFU0xlZ2FjeSIsIl9oYW5kbGVBRVNNaWRkbGV3YXJlIiwiX2hhbmRsZUpXVEFQSU1pZGRsZXdhcmUiLCJzY2hlbWUiLCJ0b2tlbiIsInBhcnNlQXV0aFRva2VuSGVhZGVyIiwidG9VcHBlckNhc2UiLCJUT0tFTl9CQVNJQyIsImNyZWRlbnRpYWxzIiwiY29udmVydFBheWxvYWRUb0Jhc2U2NCIsInRvU3RyaW5nIiwicGFyc2VCYXNpY1BheWxvYWQiLCJnZXRNaWRkbGV3YXJlQ3JlZGVudGlhbHMiLCJnZXRGb3JiaWRkZW4iLCJCQURfVVNFUk5BTUVfUEFTU1dPUkQiLCJpc1VuZGVmaW5lZCIsIndlYlVJSldUbWlkZGxld2FyZSIsInN0YXR1cyIsInN0YXR1c0NvZGUiLCJzZW5kIiwicmVwbGFjZSIsIlRPS0VOX0JFQVJFUiIsInZlcmlmeUpXVFBheWxvYWQiLCJqd3RFbmNyeXB0Iiwic2lnbk9wdGlvbnMiLCJyZWFsX2dyb3VwcyIsInJlYWxHcm91cHNWYWxpZGF0ZWQiLCJncm91cGVkR3JvdXBzIiwiQXJyYXkiLCJmcm9tIiwiU2V0IiwiY29uY2F0IiwicGF5bG9hZCIsInNpZ25QYXlsb2FkIiwiYWVzRW5jcnlwdCIsImJ1ZiIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXV0aC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYnVpbGREZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5pbXBvcnQgeyBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIsIGNyZWF0ZVJlbW90ZVVzZXIgfSBmcm9tICdAdmVyZGFjY2lvL2NvbmZpZyc7XG5pbXBvcnQgeyBWZXJkYWNjaW9FcnJvciwgcGx1Z2luVXRpbHMgfSBmcm9tICdAdmVyZGFjY2lvL2NvcmUnO1xuaW1wb3J0IHsgYWVzRW5jcnlwdERlcHJlY2F0ZWQgYXMgYWVzRW5jcnlwdCwgc2lnblBheWxvYWQgfSBmcm9tICdAdmVyZGFjY2lvL3NpZ25hdHVyZSc7XG5pbXBvcnQge1xuICBBbGxvd0FjY2VzcyxcbiAgQ2FsbGJhY2ssXG4gIENvbmZpZyxcbiAgSldUU2lnbk9wdGlvbnMsXG4gIExvZ2dlcixcbiAgUGFja2FnZUFjY2VzcyxcbiAgUmVtb3RlVXNlcixcbiAgU2VjdXJpdHksXG59IGZyb20gJ0B2ZXJkYWNjaW8vdHlwZXMnO1xuaW1wb3J0IHsgZ2V0TWF0Y2hlZFBhY2thZ2VzU3BlYyB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgbG9hZFBsdWdpbiBmcm9tICcuLi9saWIvcGx1Z2luLWxvYWRlcic7XG5pbXBvcnQgeyAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCBBRVNQYXlsb2FkIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtcbiAgZ2V0RGVmYXVsdFBsdWdpbnMsXG4gIGdldE1pZGRsZXdhcmVDcmVkZW50aWFscyxcbiAgZ2V0U2VjdXJpdHksXG4gIGlzQUVTTGVnYWN5LFxuICBpc0F1dGhIZWFkZXJWYWxpZCxcbiAgcGFyc2VBdXRoVG9rZW5IZWFkZXIsXG4gIHBhcnNlQmFzaWNQYXlsb2FkLFxuICB2ZXJpZnlKV1RQYXlsb2FkLFxufSBmcm9tICcuL2F1dGgtdXRpbHMnO1xuaW1wb3J0IHsgQVBJX0VSUk9SLCBTVVBQT1JUX0VSUk9SUywgVE9LRU5fQkFTSUMsIFRPS0VOX0JFQVJFUiB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IEVycm9yQ29kZSwgY29udmVydFBheWxvYWRUb0Jhc2U2NCB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBkZWJ1ZyA9IGJ1aWxkRGVidWcoJ3ZlcmRhY2NpbzphdXRoJyk7XG5cbmNsYXNzIEF1dGgge1xuICBwdWJsaWMgY29uZmlnOiBDb25maWc7XG4gIHB1YmxpYyBsb2dnZXI6IExvZ2dlcjtcbiAgcHVibGljIHNlY3JldDogc3RyaW5nO1xuICBwdWJsaWMgcGx1Z2luczogcGx1Z2luVXRpbHMuQXV0aDxDb25maWc+W107XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKGNvbmZpZzogQ29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgdGhpcy5zZWNyZXQgPSBjb25maWcuc2VjcmV0O1xuICAgIHRoaXMucGx1Z2lucyA9IHRoaXMuX2xvYWRQbHVnaW4oY29uZmlnKTtcbiAgICB0aGlzLl9hcHBseURlZmF1bHRQbHVnaW5zKCk7XG4gIH1cblxuICBwcml2YXRlIF9sb2FkUGx1Z2luKGNvbmZpZzogQ29uZmlnKTogcGx1Z2luVXRpbHMuQXV0aDxDb25maWc+W10ge1xuICAgIGNvbnN0IHBsdWdpbk9wdGlvbnMgPSB7XG4gICAgICBjb25maWcsXG4gICAgICBsb2dnZXI6IHRoaXMubG9nZ2VyLFxuICAgIH07XG5cbiAgICBsZXQgYXV0aENvbmYgPSB7IC4uLmNvbmZpZy5hdXRoIH07XG4gICAgaWYgKGF1dGhDb25mPy5odHBhc3N3ZCkge1xuICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciBodHBhc3N3ZCBwbHVnaW4sIHRoZSB2NiB2ZXJzaW9uIHVzZXMgYmNyeXB0IGJ5IGRlZmF1bHRcbiAgICAgIC8vIDUueCBlbmZvcmNlcyBjcnlwdCB0byBhdm9pZCBicmVha2luZyBjaGFuZ2VzLCBidXQgaXMgaGlnaGx5IHJlY29tbWVuZGVkIHVzaW5nXG4gICAgICAvLyBiY3J5cHQgaW5zdGVhZC5cbiAgICAgIGlmICghYXV0aENvbmYuaHRwYXNzd2QuYWxnb3JpdGhtKSB7XG4gICAgICAgIGF1dGhDb25mLmh0cGFzc3dkLmFsZ29yaXRobSA9ICdjcnlwdCc7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cbiAgICAgICAgICAndGhlIFwiY3J5cHRcIiBhbGdvcml0aG0gaXMgZGVwcmVjYXRlZCBjb25zaWRlciBzd2l0Y2ggdG8gXCJiY3J5cHRcIiBpbiB0aGUgY29uZmlndXJhdGlvbiBmaWxlLiBSZWFkIHRoZSBkb2N1bWVudGF0aW9uIGZvciBhZGRpdGlvbmFsIGRldGFpbHMnXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxvYWRQbHVnaW48cGx1Z2luVXRpbHMuQXV0aDxDb25maWc+PihcbiAgICAgIGNvbmZpZyxcbiAgICAgIGF1dGhDb25mLFxuICAgICAgcGx1Z2luT3B0aW9ucyxcbiAgICAgIChwbHVnaW46IHBsdWdpblV0aWxzLkF1dGg8Q29uZmlnPik6IGJvb2xlYW4gPT4ge1xuICAgICAgICBjb25zdCB7IGF1dGhlbnRpY2F0ZSwgYWxsb3dfYWNjZXNzLCBhbGxvd19wdWJsaXNoIH0gPSBwbHVnaW47XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIGF1dGhlbnRpY2F0ZSB8fCBhbGxvd19hY2Nlc3MgfHwgYWxsb3dfcHVibGlzaDtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfYXBwbHlEZWZhdWx0UGx1Z2lucygpOiB2b2lkIHtcbiAgICB0aGlzLnBsdWdpbnMucHVzaChnZXREZWZhdWx0UGx1Z2lucyh0aGlzLmxvZ2dlcikpO1xuICB9XG5cbiAgcHVibGljIGNoYW5nZVBhc3N3b3JkKFxuICAgIHVzZXJuYW1lOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZywgLy8gcHJhZ21hOiBhbGxvd2xpc3Qgc2VjcmV0XG4gICAgbmV3UGFzc3dvcmQ6IHN0cmluZywgLy8gcHJhZ21hOiBhbGxvd2xpc3Qgc2VjcmV0XG4gICAgY2I6IENhbGxiYWNrXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHZhbGlkUGx1Z2lucyA9IF8uZmlsdGVyKHRoaXMucGx1Z2lucywgKHBsdWdpbikgPT4gXy5pc0Z1bmN0aW9uKHBsdWdpbi5jaGFuZ2VQYXNzd29yZCkpO1xuXG4gICAgaWYgKF8uaXNFbXB0eSh2YWxpZFBsdWdpbnMpKSB7XG4gICAgICByZXR1cm4gY2IoRXJyb3JDb2RlLmdldEludGVybmFsRXJyb3IoU1VQUE9SVF9FUlJPUlMuUExVR0lOX01JU1NJTkdfSU5URVJGQUNFKSk7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBwbHVnaW4gb2YgdmFsaWRQbHVnaW5zKSB7XG4gICAgICBpZiAoXy5pc05pbChwbHVnaW4pIHx8IF8uaXNGdW5jdGlvbihwbHVnaW4uY2hhbmdlUGFzc3dvcmQpID09PSBmYWxzZSkge1xuICAgICAgICBkZWJ1ZygnYXV0aCBwbHVnaW4gZG9lcyBub3QgaW1wbGVtZW50IGNoYW5nZVBhc3N3b3JkLCB0cnlpbmcgbmV4dCBvbmUnKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWJ1ZygndXBkYXRpbmcgcGFzc3dvcmQgZm9yICVvJywgdXNlcm5hbWUpO1xuICAgICAgICBwbHVnaW4uY2hhbmdlUGFzc3dvcmQhKHVzZXJuYW1lLCBwYXNzd29yZCwgbmV3UGFzc3dvcmQsIChlcnIsIHByb2ZpbGUpOiB2b2lkID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgICAgeyB1c2VybmFtZSwgZXJyIH0sXG4gICAgICAgICAgICAgIGBBbiBlcnJvciBoYXMgYmVlbiBwcm9kdWNlZFxuICAgICAgICAgICAgdXBkYXRpbmcgdGhlIHBhc3N3b3JkIGZvciBAe3VzZXJuYW1lfS4gRXJyb3I6IEB7ZXJyLm1lc3NhZ2V9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKHsgdXNlcm5hbWUgfSwgJ3VwZGF0ZWQgcGFzc3dvcmQgZm9yIEB7dXNlcm5hbWV9IHdhcyBzdWNjZXNzZnVsJyk7XG4gICAgICAgICAgcmV0dXJuIGNiKG51bGwsIHByb2ZpbGUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXV0aGVudGljYXRlKHVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcsIGNiOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGNvbnN0IHBsdWdpbnMgPSB0aGlzLnBsdWdpbnMuc2xpY2UoMCk7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgKGZ1bmN0aW9uIG5leHQoKTogdm9pZCB7XG4gICAgICBjb25zdCBwbHVnaW4gPSBwbHVnaW5zLnNoaWZ0KCkgYXMgcGx1Z2luVXRpbHMuQXV0aDxDb25maWc+O1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihwbHVnaW4uYXV0aGVudGljYXRlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH1cbiAgICAgIGRlYnVnKCdhdXRoZW50aWNhdGluZyAlbycsIHVzZXJuYW1lKTtcbiAgICAgIHBsdWdpbi5hdXRoZW50aWNhdGUodXNlcm5hbWUsIHBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyLCBncm91cHMpOiB2b2lkIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgeyB1c2VybmFtZSwgZXJyIH0sXG4gICAgICAgICAgICAnYXV0aGVudGljYXRpbmcgZm9yIHVzZXIgQHt1c2VybmFtZX0gZmFpbGVkLiBFcnJvcjogQHtlcnIubWVzc2FnZX0nXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gY2IoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEV4cGVjdDogU0tJUCBpZiBncm91cHMgaXMgZmFsc2V5IGFuZCBub3QgYW4gYXJyYXlcbiAgICAgICAgLy8gICAgICAgICB3aXRoIGF0IGxlYXN0IG9uZSBpdGVtICh0cnV0aHkgbGVuZ3RoKVxuICAgICAgICAvLyBFeHBlY3Q6IENPTlRJTlVFIG90aGVyd2lzZSAod2lsbCBlcnJvciBpZiBncm91cHMgaXMgbm90XG4gICAgICAgIC8vICAgICAgICAgYW4gYXJyYXksIGJ1dCB0aGlzIGlzIGN1cnJlbnQgYmVoYXZpb3IpXG4gICAgICAgIC8vIENhdmVhdDogU1RSSU5HIChpZiB2YWxpZCkgd2lsbCBwYXNzIHN1Y2Nlc3NmdWxseVxuICAgICAgICAvLyAgICAgICAgIGJ1ZyBnaXZlIHVuZXhwZWN0ZWQgcmVzdWx0c1xuICAgICAgICAvLyBJbmZvOiBDYW5ub3QgdXNlIGA9PSBmYWxzZSB0byBjaGVjayBmYWxzZXkgdmFsdWVzYFxuICAgICAgICBpZiAoISFncm91cHMgJiYgZ3JvdXBzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgIC8vIFRPRE86IGNyZWF0ZSBhIGJldHRlciB1bmRlcnN0YW5kaW5nIG9mIGV4cGVjdGF0aW9uc1xuICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGdyb3VwcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3BsdWdpbiBncm91cCBlcnJvcjogaW52YWxpZCB0eXBlIGZvciBmdW5jdGlvbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpc0dyb3VwVmFsaWQ6IGJvb2xlYW4gPSBfLmlzQXJyYXkoZ3JvdXBzKTtcbiAgICAgICAgICBpZiAoIWlzR3JvdXBWYWxpZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihBUElfRVJST1IuQkFEX0ZPUk1BVF9VU0VSX0dST1VQKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVidWcoJ2F1dGhlbnRpY2F0aW9uIGZvciB1c2VyICVvIHdhcyBzdWNjZXNzZnVsbHkuIEdyb3VwczogJW8nLCB1c2VybmFtZSwgZ3JvdXBzKTtcbiAgICAgICAgICByZXR1cm4gY2IoZXJyLCBjcmVhdGVSZW1vdGVVc2VyKHVzZXJuYW1lLCBncm91cHMpKTtcbiAgICAgICAgfVxuICAgICAgICBuZXh0KCk7XG4gICAgICB9KTtcbiAgICB9KSgpO1xuICB9XG5cbiAgcHVibGljIGFkZF91c2VyKHVzZXI6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZywgY2I6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgcGx1Z2lucyA9IHRoaXMucGx1Z2lucy5zbGljZSgwKTtcbiAgICBkZWJ1ZygnYWRkIHVzZXIgJW8nLCB1c2VyKTtcbiAgICAoZnVuY3Rpb24gbmV4dCgpOiB2b2lkIHtcbiAgICAgIGNvbnN0IHBsdWdpbiA9IHBsdWdpbnMuc2hpZnQoKSBhcyBwbHVnaW5VdGlscy5BdXRoPENvbmZpZz47XG4gICAgICBsZXQgbWV0aG9kID0gJ2FkZHVzZXInO1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihwbHVnaW5bbWV0aG9kXSkgPT09IGZhbHNlKSB7XG4gICAgICAgIG1ldGhvZCA9ICdhZGRfdXNlcic7XG4gICAgICAgIHNlbGYubG9nZ2VyLndhcm4oXG4gICAgICAgICAgJ3RoZSBwbHVnaW4gbWV0aG9kIGFkZF91c2VyIGluIHRoZSBhdXRoIHBsdWdpbiBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gbmV4dCBtYWpvciByZWxlYXNlLCBub3RpZnkgdG8gdGhlIHBsdWdpbiBhdXRob3InXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChfLmlzRnVuY3Rpb24ocGx1Z2luW21ldGhvZF0pID09PSBmYWxzZSkge1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBwLmFkZF91c2VyKCkgZXhlY3V0aW9uXG4gICAgICAgIHBsdWdpblttZXRob2RdKHVzZXIsIHBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyLCBvayk6IHZvaWQge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICB7IHVzZXIsIGVycjogZXJyLm1lc3NhZ2UgfSxcbiAgICAgICAgICAgICAgJ3RoZSB1c2VyIEB7dXNlcn0gY291bGQgbm90IGJlaW5nIGFkZGVkLiBFcnJvcjogQHtlcnJ9J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob2spIHtcbiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oeyB1c2VyIH0sICd0aGUgdXNlciBAe3VzZXJ9IGhhcyBiZWVuIGFkZGVkJyk7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hdXRoZW50aWNhdGUodXNlciwgcGFzc3dvcmQsIGNiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93IHVzZXIgdG8gYWNjZXNzIGEgcGFja2FnZS5cbiAgICovXG4gIHB1YmxpYyBhbGxvd19hY2Nlc3MoXG4gICAgeyBwYWNrYWdlTmFtZSwgcGFja2FnZVZlcnNpb24gfTogcGx1Z2luVXRpbHMuQXV0aFBsdWdpblBhY2thZ2UsXG4gICAgdXNlcjogUmVtb3RlVXNlcixcbiAgICBjYWxsYmFjazogQ2FsbGJhY2tcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcGx1Z2lucyA9IHRoaXMucGx1Z2lucy5zbGljZSgwKTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBwa2dBbGxvd0FjY2VzOiBBbGxvd0FjY2VzcyA9IHsgbmFtZTogcGFja2FnZU5hbWUsIHZlcnNpb246IHBhY2thZ2VWZXJzaW9uIH07XG4gICAgY29uc3QgcGtnID0gT2JqZWN0LmFzc2lnbihcbiAgICAgIHt9LFxuICAgICAgcGtnQWxsb3dBY2NlcyxcbiAgICAgIGdldE1hdGNoZWRQYWNrYWdlc1NwZWMocGFja2FnZU5hbWUsIHRoaXMuY29uZmlnLnBhY2thZ2VzKVxuICAgICkgYXMgQWxsb3dBY2Nlc3MgJiBQYWNrYWdlQWNjZXNzO1xuICAgIGRlYnVnKCdhbGxvdyBhY2Nlc3MgZm9yICVvJywgcGFja2FnZU5hbWUpO1xuXG4gICAgKGZ1bmN0aW9uIG5leHQoKTogdm9pZCB7XG4gICAgICBjb25zdCBwbHVnaW46IHBsdWdpblV0aWxzLkF1dGg8dW5rbm93bj4gPSBwbHVnaW5zLnNoaWZ0KCkgYXMgcGx1Z2luVXRpbHMuQXV0aDxDb25maWc+O1xuXG4gICAgICBpZiAoXy5pc05pbChwbHVnaW4pIHx8IF8uaXNGdW5jdGlvbihwbHVnaW4uYWxsb3dfYWNjZXNzKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgcGx1Z2luLmFsbG93X2FjY2VzcyEodXNlciwgcGtnLCBmdW5jdGlvbiAoZXJyOiBWZXJkYWNjaW9FcnJvciB8IG51bGwsIG9rPzogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICB7IHBhY2thZ2VOYW1lLCBlcnIgfSxcbiAgICAgICAgICAgICdmb3JiaWRkZW4gYWNjZXNzIGZvciBAe3BhY2thZ2VOYW1lfS4gRXJyb3I6IEB7ZXJyLm1lc3NhZ2V9J1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2spIHtcbiAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKHsgcGFja2FnZU5hbWUgfSwgJ2FsbG93ZWQgYWNjZXNzIGZvciBAe3BhY2thZ2VOYW1lfScpO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBvayk7XG4gICAgICAgIH1cblxuICAgICAgICBuZXh0KCk7IC8vIGNiKG51bGwsIGZhbHNlKSBjYXVzZXMgbmV4dCBwbHVnaW4gdG8gcm9sbFxuICAgICAgfSk7XG4gICAgfSkoKTtcbiAgfVxuXG4gIHB1YmxpYyBhbGxvd191bnB1Ymxpc2goXG4gICAgeyBwYWNrYWdlTmFtZSwgcGFja2FnZVZlcnNpb24gfTogcGx1Z2luVXRpbHMuQXV0aFBsdWdpblBhY2thZ2UsXG4gICAgdXNlcjogUmVtb3RlVXNlcixcbiAgICBjYWxsYmFjazogQ2FsbGJhY2tcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcGtnID0gT2JqZWN0LmFzc2lnbihcbiAgICAgIHsgbmFtZTogcGFja2FnZU5hbWUsIHZlcnNpb246IHBhY2thZ2VWZXJzaW9uIH0sXG4gICAgICBnZXRNYXRjaGVkUGFja2FnZXNTcGVjKHBhY2thZ2VOYW1lLCB0aGlzLmNvbmZpZy5wYWNrYWdlcylcbiAgICApO1xuICAgIGRlYnVnKCdhbGxvdyB1bnB1Ymxpc2ggZm9yICVvJywgcGFja2FnZU5hbWUpO1xuICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIHRoaXMucGx1Z2lucykge1xuICAgICAgaWYgKF8uaXNOaWwocGx1Z2luKSB8fCBfLmlzRnVuY3Rpb24ocGx1Z2luLmFsbG93X3VucHVibGlzaCkgPT09IGZhbHNlKSB7XG4gICAgICAgIGRlYnVnKCdhbGxvdyB1bnB1Ymxpc2ggZm9yICVvIHBsdWdpbiBkb2VzIG5vdCBpbXBsZW1lbnQgYWxsb3dfdW5wdWJsaXNoJywgcGFja2FnZU5hbWUpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcGx1Z2luLmFsbG93X3VucHVibGlzaCEodXNlciwgcGtnLCAoZXJyLCBvazogYm9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICB7IHBhY2thZ2VOYW1lLCB1c2VyOiB1c2VyPy5uYW1lIH0sXG4gICAgICAgICAgICAgICdAe3VzZXJ9IGZvcmJpZGRlbiBwdWJsaXNoIGZvciBAe3BhY2thZ2VOYW1lfSwgaXQgd2lsbCBmYWxsYmFjayBvbiB1bnB1Ymxpc2ggcGVybWlzc2lvbnMnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKF8uaXNOaWwob2spID09PSB0cnVlKSB7XG4gICAgICAgICAgICBkZWJ1Zygnd2UgYnlwYXNzIHVucHVibGlzaCBmb3IgJW8sIHB1Ymxpc2ggd2lsbCBoYW5kbGUgdGhlIGFjY2VzcycsIHBhY2thZ2VOYW1lKTtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxsb3dfcHVibGlzaCguLi5hcmd1bWVudHMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChvaykge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcbiAgICAgICAgICAgICAgeyBwYWNrYWdlTmFtZSwgdXNlcjogdXNlcj8ubmFtZSB9LFxuICAgICAgICAgICAgICAnQHt1c2VyfSBhbGxvd2VkIHVucHVibGlzaCBmb3IgQHtwYWNrYWdlTmFtZX0nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIG9rKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBbGxvdyB1c2VyIHRvIHB1Ymxpc2ggYSBwYWNrYWdlLlxuICAgKi9cbiAgcHVibGljIGFsbG93X3B1Ymxpc2goXG4gICAgeyBwYWNrYWdlTmFtZSwgcGFja2FnZVZlcnNpb24gfTogcGx1Z2luVXRpbHMuQXV0aFBsdWdpblBhY2thZ2UsXG4gICAgdXNlcjogUmVtb3RlVXNlcixcbiAgICBjYWxsYmFjazogQ2FsbGJhY2tcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcGx1Z2lucyA9IHRoaXMucGx1Z2lucy5zbGljZSgwKTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBwa2cgPSBPYmplY3QuYXNzaWduKFxuICAgICAgeyBuYW1lOiBwYWNrYWdlTmFtZSwgdmVyc2lvbjogcGFja2FnZVZlcnNpb24gfSxcbiAgICAgIGdldE1hdGNoZWRQYWNrYWdlc1NwZWMocGFja2FnZU5hbWUsIHRoaXMuY29uZmlnLnBhY2thZ2VzKVxuICAgICk7XG4gICAgZGVidWcoJ2FsbG93IHB1Ymxpc2ggZm9yICVvIGluaXQgfCBwbHVnaW5zOiAlbycsIHBhY2thZ2VOYW1lLCBwbHVnaW5zKTtcbiAgICAoZnVuY3Rpb24gbmV4dCgpOiB2b2lkIHtcbiAgICAgIGNvbnN0IHBsdWdpbiA9IHBsdWdpbnMuc2hpZnQoKTtcblxuICAgICAgaWYgKF8uaXNOaWwocGx1Z2luKSB8fCBfLmlzRnVuY3Rpb24ocGx1Z2luLmFsbG93X3B1Ymxpc2gpID09PSBmYWxzZSkge1xuICAgICAgICBkZWJ1ZygnYWxsb3cgcHVibGlzaCBmb3IgJW8gcGx1Z2luIGRvZXMgbm90IGltcGxlbWVudCBhbGxvd19wdWJsaXNoJywgcGFja2FnZU5hbWUpO1xuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBwbHVnaW4uYWxsb3dfcHVibGlzaCh1c2VyLCBwa2csIChlcnI6IGFueSwgb2s6IGJvb2xlYW4pOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKF8uaXNOaWwoZXJyKSA9PT0gZmFsc2UgJiYgXy5pc0Vycm9yKGVycikpIHtcbiAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIHsgcGFja2FnZU5hbWUsIHVzZXI6IHVzZXI/Lm5hbWUgfSxcbiAgICAgICAgICAgICdAe3VzZXJ9IGlzIGZvcmJpZGRlbiBwdWJsaXNoIGZvciBAe3BhY2thZ2VOYW1lfSdcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9rKSB7XG4gICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhcbiAgICAgICAgICAgIHsgcGFja2FnZU5hbWUsIHVzZXI6IHVzZXI/Lm5hbWUgfSxcbiAgICAgICAgICAgICdAe3VzZXJ9IGlzIGFsbG93ZWQgcHVibGlzaCBmb3IgQHtwYWNrYWdlTmFtZX0nXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgb2spO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnKCdhbGxvdyBwdWJsaXNoIHNraXAgdmFsaWRhdGlvbiBmb3IgJW8nLCBwYWNrYWdlTmFtZSk7XG4gICAgICAgIG5leHQoKTsgLy8gY2IobnVsbCwgZmFsc2UpIGNhdXNlcyBuZXh0IHBsdWdpbiB0byByb2xsXG4gICAgICB9KTtcbiAgICB9KSgpO1xuICB9XG5cbiAgcHVibGljIGFwaUpXVG1pZGRsZXdhcmUoKSB7XG4gICAgY29uc3QgcGx1Z2lucyA9IHRoaXMucGx1Z2lucy5zbGljZSgwKTtcbiAgICBjb25zdCBoZWxwZXJzID0geyBjcmVhdGVBbm9ueW1vdXNSZW1vdGVVc2VyLCBjcmVhdGVSZW1vdGVVc2VyIH07XG4gICAgZm9yIChjb25zdCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgICAgaWYgKHBsdWdpbi5hcGlKV1RtaWRkbGV3YXJlKSB7XG4gICAgICAgIHJldHVybiBwbHVnaW4uYXBpSldUbWlkZGxld2FyZShoZWxwZXJzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBfbmV4dDogTmV4dEZ1bmN0aW9uKTogdm9pZCA9PiB7XG4gICAgICByZXEucGF1c2UoKTtcblxuICAgICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uIChlcnI6IGFueSB8IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgcmVxLnJlc3VtZSgpO1xuICAgICAgICAvLyB1bmNvbW1lbnQgdGhpcyB0byByZWplY3QgdXNlcnMgd2l0aCBiYWQgYXV0aCBoZWFkZXJzXG4gICAgICAgIC8vIHJldHVybiBfbmV4dC5hcHBseShudWxsLCBhcmd1bWVudHMpXG4gICAgICAgIC8vIHN3YWxsb3cgZXJyb3IsIHVzZXIgcmVtYWlucyB1bmF1dGhvcml6ZWRcbiAgICAgICAgLy8gc2V0IHJlbW90ZVVzZXJFcnJvciB0byBpbmRpY2F0ZSB0aGF0IHVzZXIgd2FzIGF0dGVtcHRpbmcgYXV0aGVudGljYXRpb25cbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlcS5yZW1vdGVfdXNlci5lcnJvciA9IGVyci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfbmV4dCgpO1xuICAgICAgfTtcblxuICAgICAgaWYgKHRoaXMuX2lzUmVtb3RlVXNlclZhbGlkKHJlcS5yZW1vdGVfdXNlcikpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBpbiBjYXNlIGF1dGggaGVhZGVyIGRvZXMgbm90IGV4aXN0IHdlIHJldHVybiBhbm9ueW1vdXMgZnVuY3Rpb25cbiAgICAgIHJlcS5yZW1vdGVfdXNlciA9IGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIoKTtcblxuICAgICAgY29uc3QgeyBhdXRob3JpemF0aW9uIH0gPSByZXEuaGVhZGVycztcbiAgICAgIGlmIChfLmlzTmlsKGF1dGhvcml6YXRpb24pKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc0F1dGhIZWFkZXJWYWxpZChhdXRob3JpemF0aW9uKSkge1xuICAgICAgICBkZWJ1ZygnYXBpIG1pZGRsZXdhcmUgYXV0aCBoZWF0aGVyIGlzIG5vdCB2YWxpZCcpO1xuICAgICAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0QmFkUmVxdWVzdChBUElfRVJST1IuQkFEX0FVVEhfSEVBREVSKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNlY3VyaXR5OiBTZWN1cml0eSA9IGdldFNlY3VyaXR5KHRoaXMuY29uZmlnKTtcbiAgICAgIGNvbnN0IHsgc2VjcmV0IH0gPSB0aGlzLmNvbmZpZztcblxuICAgICAgaWYgKGlzQUVTTGVnYWN5KHNlY3VyaXR5KSkge1xuICAgICAgICBkZWJ1ZygnYXBpIG1pZGRsZXdhcmUgdXNpbmcgbGVnYWN5IGF1dGggdG9rZW4nKTtcbiAgICAgICAgdGhpcy5faGFuZGxlQUVTTWlkZGxld2FyZShyZXEsIHNlY3VyaXR5LCBzZWNyZXQsIGF1dGhvcml6YXRpb24sIG5leHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVidWcoJ2FwaSBtaWRkbGV3YXJlIHVzaW5nIEpXVCBhdXRoIHRva2VuJyk7XG4gICAgICAgIHRoaXMuX2hhbmRsZUpXVEFQSU1pZGRsZXdhcmUocmVxLCBzZWN1cml0eSwgc2VjcmV0LCBhdXRob3JpemF0aW9uLCBuZXh0KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBfaGFuZGxlSldUQVBJTWlkZGxld2FyZShcbiAgICByZXE6ICRSZXF1ZXN0RXh0ZW5kLFxuICAgIHNlY3VyaXR5OiBTZWN1cml0eSxcbiAgICBzZWNyZXQ6IHN0cmluZyxcbiAgICBhdXRob3JpemF0aW9uOiBzdHJpbmcsXG4gICAgbmV4dDogRnVuY3Rpb25cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgeyBzY2hlbWUsIHRva2VuIH0gPSBwYXJzZUF1dGhUb2tlbkhlYWRlcihhdXRob3JpemF0aW9uKTtcbiAgICBpZiAoc2NoZW1lLnRvVXBwZXJDYXNlKCkgPT09IFRPS0VOX0JBU0lDLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgIC8vIHRoaXMgc2hvdWxkIGhhcHBlbiB3aGVuIGNsaWVudCB0cmllcyB0byBsb2dpbiB3aXRoIGFuIGV4aXN0aW5nIHVzZXJcbiAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gY29udmVydFBheWxvYWRUb0Jhc2U2NCh0b2tlbikudG9TdHJpbmcoKTtcbiAgICAgIGNvbnN0IHsgdXNlciwgcGFzc3dvcmQgfSA9IHBhcnNlQmFzaWNQYXlsb2FkKGNyZWRlbnRpYWxzKSBhcyBBRVNQYXlsb2FkO1xuICAgICAgdGhpcy5hdXRoZW50aWNhdGUodXNlciwgcGFzc3dvcmQsIChlcnIsIHVzZXIpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICByZXEucmVtb3RlX3VzZXIgPSB1c2VyO1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXEucmVtb3RlX3VzZXIgPSBjcmVhdGVBbm9ueW1vdXNSZW1vdGVVc2VyKCk7XG4gICAgICAgICAgbmV4dChlcnIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gand0IGhhbmRsZXJcbiAgICAgIGNvbnN0IGNyZWRlbnRpYWxzOiBhbnkgPSBnZXRNaWRkbGV3YXJlQ3JlZGVudGlhbHMoc2VjdXJpdHksIHNlY3JldCwgYXV0aG9yaXphdGlvbik7XG4gICAgICBpZiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgLy8gaWYgdGhlIHNpZ25hdHVyZSBpcyB2YWxpZCB3ZSByZWx5IG9uIGl0XG4gICAgICAgIHJlcS5yZW1vdGVfdXNlciA9IGNyZWRlbnRpYWxzO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB3aXRoIEpXVCB0aHJvdyA0MDFcbiAgICAgICAgbmV4dChFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKEFQSV9FUlJPUi5CQURfVVNFUk5BTUVfUEFTU1dPUkQpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9oYW5kbGVBRVNNaWRkbGV3YXJlKFxuICAgIHJlcTogJFJlcXVlc3RFeHRlbmQsXG4gICAgc2VjdXJpdHk6IFNlY3VyaXR5LFxuICAgIHNlY3JldDogc3RyaW5nLFxuICAgIGF1dGhvcml6YXRpb246IHN0cmluZyxcbiAgICBuZXh0OiBGdW5jdGlvblxuICApOiB2b2lkIHtcbiAgICBjb25zdCBjcmVkZW50aWFsczogYW55ID0gZ2V0TWlkZGxld2FyZUNyZWRlbnRpYWxzKHNlY3VyaXR5LCBzZWNyZXQsIGF1dGhvcml6YXRpb24pO1xuICAgIGlmIChjcmVkZW50aWFscykge1xuICAgICAgY29uc3QgeyB1c2VyLCBwYXNzd29yZCB9ID0gY3JlZGVudGlhbHM7XG4gICAgICB0aGlzLmF1dGhlbnRpY2F0ZSh1c2VyLCBwYXNzd29yZCwgKGVyciwgdXNlcik6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgIHJlcS5yZW1vdGVfdXNlciA9IHVzZXI7XG4gICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcS5yZW1vdGVfdXNlciA9IGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIoKTtcbiAgICAgICAgICBuZXh0KGVycik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB3ZSBmb3JjZSBucG0gY2xpZW50IHRvIGFzayBhZ2FpbiB3aXRoIGJhc2ljIGF1dGhlbnRpY2F0aW9uXG4gICAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0QmFkUmVxdWVzdChBUElfRVJST1IuQkFEX0FVVEhfSEVBREVSKSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfaXNSZW1vdGVVc2VyVmFsaWQocmVtb3RlX3VzZXI6IFJlbW90ZVVzZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gXy5pc1VuZGVmaW5lZChyZW1vdGVfdXNlcikgPT09IGZhbHNlICYmIF8uaXNVbmRlZmluZWQocmVtb3RlX3VzZXIubmFtZSkgPT09IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEpXVCBtaWRkbGV3YXJlIGZvciBXZWJVSVxuICAgKi9cbiAgcHVibGljIHdlYlVJSldUbWlkZGxld2FyZSgpOiBGdW5jdGlvbiB7XG4gICAgcmV0dXJuIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgX25leHQ6IE5leHRGdW5jdGlvbik6IHZvaWQgPT4ge1xuICAgICAgaWYgKHRoaXMuX2lzUmVtb3RlVXNlclZhbGlkKHJlcS5yZW1vdGVfdXNlcikpIHtcbiAgICAgICAgcmV0dXJuIF9uZXh0KCk7XG4gICAgICB9XG5cbiAgICAgIHJlcS5wYXVzZSgpO1xuICAgICAgY29uc3QgbmV4dCA9IChlcnI6IGFueSB8IHZvaWQpOiB2b2lkID0+IHtcbiAgICAgICAgcmVxLnJlc3VtZSgpO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgLy8gcmVxLnJlbW90ZV91c2VyLmVycm9yID0gZXJyLm1lc3NhZ2U7XG4gICAgICAgICAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSkuc2VuZChlcnIubWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX25leHQoKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgYXV0aG9yaXphdGlvbiB9ID0gcmVxLmhlYWRlcnM7XG4gICAgICBpZiAoXy5pc05pbChhdXRob3JpemF0aW9uKSkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNBdXRoSGVhZGVyVmFsaWQoYXV0aG9yaXphdGlvbikpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoRXJyb3JDb2RlLmdldEJhZFJlcXVlc3QoQVBJX0VSUk9SLkJBRF9BVVRIX0hFQURFUikpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IChhdXRob3JpemF0aW9uIHx8ICcnKS5yZXBsYWNlKGAke1RPS0VOX0JFQVJFUn0gYCwgJycpO1xuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICB9XG5cbiAgICAgIGxldCBjcmVkZW50aWFscztcbiAgICAgIHRyeSB7XG4gICAgICAgIGNyZWRlbnRpYWxzID0gdmVyaWZ5SldUUGF5bG9hZCh0b2tlbiwgdGhpcy5jb25maWcuc2VjcmV0KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBGSVhNRTogaW50ZW5kZWQgYmVoYXZpb3VyLCBkbyB3ZSB3YW50IGl0P1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5faXNSZW1vdGVVc2VyVmFsaWQoY3JlZGVudGlhbHMpKSB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZ3JvdXBzIH0gPSBjcmVkZW50aWFscztcbiAgICAgICAgcmVxLnJlbW90ZV91c2VyID0gY3JlYXRlUmVtb3RlVXNlcihuYW1lLCBncm91cHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxLnJlbW90ZV91c2VyID0gY3JlYXRlQW5vbnltb3VzUmVtb3RlVXNlcigpO1xuICAgICAgfVxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgbmV4dCgpO1xuICAgIH07XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgand0RW5jcnlwdCh1c2VyOiBSZW1vdGVVc2VyLCBzaWduT3B0aW9uczogSldUU2lnbk9wdGlvbnMpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHsgcmVhbF9ncm91cHMsIG5hbWUsIGdyb3VwcyB9ID0gdXNlcjtcbiAgICBjb25zdCByZWFsR3JvdXBzVmFsaWRhdGVkID0gXy5pc05pbChyZWFsX2dyb3VwcykgPyBbXSA6IHJlYWxfZ3JvdXBzO1xuICAgIGNvbnN0IGdyb3VwZWRHcm91cHMgPSBfLmlzTmlsKGdyb3VwcylcbiAgICAgID8gcmVhbF9ncm91cHNcbiAgICAgIDogQXJyYXkuZnJvbShuZXcgU2V0KFsuLi5ncm91cHMuY29uY2F0KHJlYWxHcm91cHNWYWxpZGF0ZWQpXSkpO1xuICAgIGNvbnN0IHBheWxvYWQ6IFJlbW90ZVVzZXIgPSB7XG4gICAgICByZWFsX2dyb3VwczogcmVhbEdyb3Vwc1ZhbGlkYXRlZCxcbiAgICAgIG5hbWUsXG4gICAgICBncm91cHM6IGdyb3VwZWRHcm91cHMsXG4gICAgfTtcblxuICAgIGNvbnN0IHRva2VuOiBzdHJpbmcgPSBhd2FpdCBzaWduUGF5bG9hZChwYXlsb2FkLCB0aGlzLnNlY3JldCwgc2lnbk9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIHRva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY3J5cHQgYSBzdHJpbmcuXG4gICAqL1xuICBwdWJsaWMgYWVzRW5jcnlwdChidWY6IEJ1ZmZlcik6IEJ1ZmZlciB7XG4gICAgcmV0dXJuIGFlc0VuY3J5cHQoYnVmLCB0aGlzLnNlY3JldCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXV0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