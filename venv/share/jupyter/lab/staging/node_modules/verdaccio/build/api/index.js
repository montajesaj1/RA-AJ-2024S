"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.loadTheme = loadTheme;
var _compression = _interopRequireDefault(require("compression"));
var _cors = _interopRequireDefault(require("cors"));
var _express = _interopRequireDefault(require("express"));
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _middleware = require("@verdaccio/middleware");
var _auth = _interopRequireDefault(require("../lib/auth"));
var _config2 = _interopRequireDefault(require("../lib/config"));
var _constants = require("../lib/constants");
var _logger = require("../lib/logger");
var _pluginLoader = _interopRequireDefault(require("../lib/plugin-loader"));
var _storage = _interopRequireDefault(require("../lib/storage"));
var _utils = require("../lib/utils");
var _debug = _interopRequireDefault(require("./debug"));
var _endpoint = _interopRequireDefault(require("./endpoint"));
var _middleware2 = require("./middleware");
var _web = _interopRequireDefault(require("./web"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const {
  version
} = require('../../package.json');
function loadTheme(config) {
  if (_lodash.default.isNil(config.theme) === false) {
    return _lodash.default.head((0, _pluginLoader.default)(config, config.theme, {}, function (plugin) {
      return plugin.staticPath && plugin.manifest && plugin.manifestFiles;
    }, 'verdaccio-theme'));
  }
}
const defineAPI = async function (config, storage) {
  var _config$server;
  const auth = new _auth.default(config);
  const app = (0, _express.default)();

  // run in production mode by default, just in case
  // it shouldn't make any difference anyway
  app.set('env', process.env.NODE_ENV || 'production');

  // Allow `req.ip` to resolve properly when Verdaccio is behind a proxy or load-balancer
  // See: https://expressjs.com/en/guide/behind-proxies.html
  if ((_config$server = config.server) !== null && _config$server !== void 0 && _config$server.trustProxy) {
    app.set('trust proxy', config.server.trustProxy);
  }
  app.use((0, _cors.default)());

  // Router setup
  app.use((0, _middleware.log)(_logger.logger));
  app.use(_middleware2.errorReportingMiddleware);
  if (config.user_agent) {
    app.use(function (_req, res, next) {
      res.setHeader('X-Powered-By', (0, _config.getUserAgent)(config.user_agent));
      next();
    });
  } else {
    app.disable('x-powered-by');
  }
  app.use((0, _compression.default)());
  app.get('/-/static/favicon.ico', (0, _middleware2.serveFavicon)(config));

  // Hook for tests only
  if (config._debug) {
    (0, _debug.default)(app, config.configPath);
  }

  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const plugins = (0, _pluginLoader.default)(config, config.middlewares, plugin_params, function (plugin) {
    // @ts-expect-error
    return plugin.register_middlewares;
  });
  plugins.forEach(plugin => {
    plugin.register_middlewares(app, auth, storage);
  });

  // For  npm request
  app.use((0, _endpoint.default)(config, auth, storage));

  // For WebUI & WebUI API
  if (_lodash.default.get(config, 'web.enable', true)) {
    app.use((_req, res, next) => {
      res.locals.app_version = version !== null && version !== void 0 ? version : '';
      next();
    });
    const midl = await (0, _web.default)(config, auth, storage);
    app.use('/', midl);
  } else {
    app.get('/', function (req, res, next) {
      next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.WEB_DISABLED));
    });
  }

  // Catch 404
  app.get('/*', function (req, res, next) {
    next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.FILE_NOT_FOUND));
  });
  app.use(_middleware2.handleError);
  app.use(_middleware.final);
  return app;
};
var _default = async function _default(configHash) {
  (0, _logger.setup)(configHash.logs);
  const config = new _config2.default(_lodash.default.cloneDeep(configHash));
  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const filters = (0, _pluginLoader.default)(config, config.filters || {}, plugin_params,
  // @ts-ignore
  plugin => plugin.filter_metadata);
  const storage = new _storage.default(config);
  // waits until init calls have been initialized
  await storage.init(config, filters);
  return await defineAPI(config, storage);
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29tcHJlc3Npb24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jb3JzIiwiX2V4cHJlc3MiLCJfbG9kYXNoIiwiX2NvbmZpZyIsIl9taWRkbGV3YXJlIiwiX2F1dGgiLCJfY29uZmlnMiIsIl9jb25zdGFudHMiLCJfbG9nZ2VyIiwiX3BsdWdpbkxvYWRlciIsIl9zdG9yYWdlIiwiX3V0aWxzIiwiX2RlYnVnIiwiX2VuZHBvaW50IiwiX21pZGRsZXdhcmUyIiwiX3dlYiIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwidmVyc2lvbiIsImxvYWRUaGVtZSIsImNvbmZpZyIsIl8iLCJpc05pbCIsInRoZW1lIiwiaGVhZCIsImxvYWRQbHVnaW4iLCJwbHVnaW4iLCJzdGF0aWNQYXRoIiwibWFuaWZlc3QiLCJtYW5pZmVzdEZpbGVzIiwiZGVmaW5lQVBJIiwic3RvcmFnZSIsIl9jb25maWckc2VydmVyIiwiYXV0aCIsIkF1dGgiLCJhcHAiLCJleHByZXNzIiwic2V0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic2VydmVyIiwidHJ1c3RQcm94eSIsInVzZSIsImNvcnMiLCJsb2ciLCJsb2dnZXIiLCJlcnJvclJlcG9ydGluZ01pZGRsZXdhcmUiLCJ1c2VyX2FnZW50IiwiX3JlcSIsInJlcyIsIm5leHQiLCJzZXRIZWFkZXIiLCJnZXRVc2VyQWdlbnQiLCJkaXNhYmxlIiwiY29tcHJlc3Npb24iLCJnZXQiLCJzZXJ2ZUZhdmljb24iLCJob29rRGVidWciLCJjb25maWdQYXRoIiwicGx1Z2luX3BhcmFtcyIsInBsdWdpbnMiLCJtaWRkbGV3YXJlcyIsInJlZ2lzdGVyX21pZGRsZXdhcmVzIiwiZm9yRWFjaCIsImFwaUVuZHBvaW50IiwibG9jYWxzIiwiYXBwX3ZlcnNpb24iLCJtaWRsIiwid2ViTWlkZGxld2FyZSIsInJlcSIsIkVycm9yQ29kZSIsImdldE5vdEZvdW5kIiwiQVBJX0VSUk9SIiwiV0VCX0RJU0FCTEVEIiwiRklMRV9OT1RfRk9VTkQiLCJoYW5kbGVFcnJvciIsImZpbmFsIiwiX2RlZmF1bHQiLCJjb25maWdIYXNoIiwic2V0dXAiLCJsb2dzIiwiQXBwQ29uZmlnIiwiY2xvbmVEZWVwIiwiZmlsdGVycyIsImZpbHRlcl9tZXRhZGF0YSIsIlN0b3JhZ2UiLCJpbml0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNvbXByZXNzaW9uIGZyb20gJ2NvbXByZXNzaW9uJztcbmltcG9ydCBjb3JzIGZyb20gJ2NvcnMnO1xuaW1wb3J0IGV4cHJlc3MsIHsgQXBwbGljYXRpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IENvbmZpZywgZ2V0VXNlckFnZW50IH0gZnJvbSAnQHZlcmRhY2Npby9jb25maWcnO1xuaW1wb3J0IHsgcGx1Z2luVXRpbHMgfSBmcm9tICdAdmVyZGFjY2lvL2NvcmUnO1xuaW1wb3J0IHsgZmluYWwgfSBmcm9tICdAdmVyZGFjY2lvL21pZGRsZXdhcmUnO1xuaW1wb3J0IHsgbG9nIH0gZnJvbSAnQHZlcmRhY2Npby9taWRkbGV3YXJlJztcbmltcG9ydCB7IENvbmZpZyBhcyBJQ29uZmlnIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5cbmltcG9ydCBBdXRoIGZyb20gJy4uL2xpYi9hdXRoJztcbmltcG9ydCBBcHBDb25maWcgZnJvbSAnLi4vbGliL2NvbmZpZyc7XG5pbXBvcnQgeyBBUElfRVJST1IgfSBmcm9tICcuLi9saWIvY29uc3RhbnRzJztcbmltcG9ydCB7IGxvZ2dlciwgc2V0dXAgfSBmcm9tICcuLi9saWIvbG9nZ2VyJztcbmltcG9ydCBsb2FkUGx1Z2luIGZyb20gJy4uL2xpYi9wbHVnaW4tbG9hZGVyJztcbmltcG9ydCBTdG9yYWdlIGZyb20gJy4uL2xpYi9zdG9yYWdlJztcbmltcG9ydCB7IEVycm9yQ29kZSB9IGZyb20gJy4uL2xpYi91dGlscyc7XG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IGhvb2tEZWJ1ZyBmcm9tICcuL2RlYnVnJztcbmltcG9ydCBhcGlFbmRwb2ludCBmcm9tICcuL2VuZHBvaW50JztcbmltcG9ydCB7IGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZSwgaGFuZGxlRXJyb3IsIHNlcnZlRmF2aWNvbiB9IGZyb20gJy4vbWlkZGxld2FyZSc7XG5pbXBvcnQgd2ViTWlkZGxld2FyZSBmcm9tICcuL3dlYic7XG5cbmNvbnN0IHsgdmVyc2lvbiB9ID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZS5qc29uJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkVGhlbWUoY29uZmlnKSB7XG4gIGlmIChfLmlzTmlsKGNvbmZpZy50aGVtZSkgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuIF8uaGVhZChcbiAgICAgIGxvYWRQbHVnaW4oXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAgY29uZmlnLnRoZW1lLFxuICAgICAgICB7fSxcbiAgICAgICAgZnVuY3Rpb24gKHBsdWdpbikge1xuICAgICAgICAgIHJldHVybiBwbHVnaW4uc3RhdGljUGF0aCAmJiBwbHVnaW4ubWFuaWZlc3QgJiYgcGx1Z2luLm1hbmlmZXN0RmlsZXM7XG4gICAgICAgIH0sXG4gICAgICAgICd2ZXJkYWNjaW8tdGhlbWUnXG4gICAgICApXG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBkZWZpbmVBUEkgPSBhc3luYyBmdW5jdGlvbiAoY29uZmlnOiBJQ29uZmlnLCBzdG9yYWdlOiBTdG9yYWdlKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgYXV0aCA9IG5ldyBBdXRoKGNvbmZpZyk7XG4gIGNvbnN0IGFwcDogQXBwbGljYXRpb24gPSBleHByZXNzKCk7XG5cbiAgLy8gcnVuIGluIHByb2R1Y3Rpb24gbW9kZSBieSBkZWZhdWx0LCBqdXN0IGluIGNhc2VcbiAgLy8gaXQgc2hvdWxkbid0IG1ha2UgYW55IGRpZmZlcmVuY2UgYW55d2F5XG4gIGFwcC5zZXQoJ2VudicsIHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdwcm9kdWN0aW9uJyk7XG5cbiAgLy8gQWxsb3cgYHJlcS5pcGAgdG8gcmVzb2x2ZSBwcm9wZXJseSB3aGVuIFZlcmRhY2NpbyBpcyBiZWhpbmQgYSBwcm94eSBvciBsb2FkLWJhbGFuY2VyXG4gIC8vIFNlZTogaHR0cHM6Ly9leHByZXNzanMuY29tL2VuL2d1aWRlL2JlaGluZC1wcm94aWVzLmh0bWxcbiAgaWYgKGNvbmZpZy5zZXJ2ZXI/LnRydXN0UHJveHkpIHtcbiAgICBhcHAuc2V0KCd0cnVzdCBwcm94eScsIGNvbmZpZy5zZXJ2ZXIudHJ1c3RQcm94eSk7XG4gIH1cblxuICBhcHAudXNlKGNvcnMoKSk7XG5cbiAgLy8gUm91dGVyIHNldHVwXG4gIGFwcC51c2UobG9nKGxvZ2dlcikpO1xuICBhcHAudXNlKGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZSk7XG4gIGlmIChjb25maWcudXNlcl9hZ2VudCkge1xuICAgIGFwcC51c2UoZnVuY3Rpb24gKF9yZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgcmVzLnNldEhlYWRlcignWC1Qb3dlcmVkLUJ5JywgZ2V0VXNlckFnZW50KGNvbmZpZy51c2VyX2FnZW50KSk7XG4gICAgICBuZXh0KCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXBwLmRpc2FibGUoJ3gtcG93ZXJlZC1ieScpO1xuICB9XG5cbiAgYXBwLnVzZShjb21wcmVzc2lvbigpKTtcblxuICBhcHAuZ2V0KCcvLS9zdGF0aWMvZmF2aWNvbi5pY28nLCBzZXJ2ZUZhdmljb24oY29uZmlnKSk7XG5cbiAgLy8gSG9vayBmb3IgdGVzdHMgb25seVxuICBpZiAoY29uZmlnLl9kZWJ1Zykge1xuICAgIGhvb2tEZWJ1ZyhhcHAsIGNvbmZpZy5jb25maWdQYXRoKTtcbiAgfVxuXG4gIC8vIHJlZ2lzdGVyIG1pZGRsZXdhcmUgcGx1Z2luc1xuICBjb25zdCBwbHVnaW5fcGFyYW1zID0ge1xuICAgIGNvbmZpZzogY29uZmlnLFxuICAgIGxvZ2dlcjogbG9nZ2VyLFxuICB9O1xuXG4gIGNvbnN0IHBsdWdpbnM6IHBsdWdpblV0aWxzLkF1dGg8SUNvbmZpZz5bXSA9IGxvYWRQbHVnaW4oXG4gICAgY29uZmlnLFxuICAgIGNvbmZpZy5taWRkbGV3YXJlcyxcbiAgICBwbHVnaW5fcGFyYW1zLFxuICAgIGZ1bmN0aW9uIChwbHVnaW46IHBsdWdpblV0aWxzLk1hbmlmZXN0RmlsdGVyPElDb25maWc+KSB7XG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICByZXR1cm4gcGx1Z2luLnJlZ2lzdGVyX21pZGRsZXdhcmVzO1xuICAgIH1cbiAgKTtcbiAgcGx1Z2lucy5mb3JFYWNoKChwbHVnaW46IGFueSkgPT4ge1xuICAgIHBsdWdpbi5yZWdpc3Rlcl9taWRkbGV3YXJlcyhhcHAsIGF1dGgsIHN0b3JhZ2UpO1xuICB9KTtcblxuICAvLyBGb3IgIG5wbSByZXF1ZXN0XG4gIGFwcC51c2UoYXBpRW5kcG9pbnQoY29uZmlnLCBhdXRoLCBzdG9yYWdlKSk7XG5cbiAgLy8gRm9yIFdlYlVJICYgV2ViVUkgQVBJXG4gIGlmIChfLmdldChjb25maWcsICd3ZWIuZW5hYmxlJywgdHJ1ZSkpIHtcbiAgICBhcHAudXNlKChfcmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHJlcy5sb2NhbHMuYXBwX3ZlcnNpb24gPSB2ZXJzaW9uID8/ICcnO1xuICAgICAgbmV4dCgpO1xuICAgIH0pO1xuICAgIGNvbnN0IG1pZGwgPSBhd2FpdCB3ZWJNaWRkbGV3YXJlKGNvbmZpZywgYXV0aCwgc3RvcmFnZSk7XG4gICAgYXBwLnVzZSgnLycsIG1pZGwpO1xuICB9IGVsc2Uge1xuICAgIGFwcC5nZXQoJy8nLCBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpIHtcbiAgICAgIG5leHQoRXJyb3JDb2RlLmdldE5vdEZvdW5kKEFQSV9FUlJPUi5XRUJfRElTQUJMRUQpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIENhdGNoIDQwNFxuICBhcHAuZ2V0KCcvKicsIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcikge1xuICAgIG5leHQoRXJyb3JDb2RlLmdldE5vdEZvdW5kKEFQSV9FUlJPUi5GSUxFX05PVF9GT1VORCkpO1xuICB9KTtcbiAgYXBwLnVzZShoYW5kbGVFcnJvcik7XG4gIGFwcC51c2UoZmluYWwpO1xuXG4gIHJldHVybiBhcHA7XG59O1xuXG5leHBvcnQgZGVmYXVsdCAoYXN5bmMgZnVuY3Rpb24gKGNvbmZpZ0hhc2g6IGFueSk6IFByb21pc2U8YW55PiB7XG4gIHNldHVwKGNvbmZpZ0hhc2gubG9ncyk7XG4gIGNvbnN0IGNvbmZpZzogSUNvbmZpZyA9IG5ldyBBcHBDb25maWcoXy5jbG9uZURlZXAoY29uZmlnSGFzaCkpO1xuICAvLyByZWdpc3RlciBtaWRkbGV3YXJlIHBsdWdpbnNcbiAgY29uc3QgcGx1Z2luX3BhcmFtcyA9IHtcbiAgICBjb25maWc6IGNvbmZpZyxcbiAgICBsb2dnZXI6IGxvZ2dlcixcbiAgfTtcbiAgY29uc3QgZmlsdGVycyA9IGxvYWRQbHVnaW4oXG4gICAgY29uZmlnLFxuICAgIGNvbmZpZy5maWx0ZXJzIHx8IHt9LFxuICAgIHBsdWdpbl9wYXJhbXMsXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIChwbHVnaW46IHBsdWdpblV0aWxzLk1hbmlmZXN0RmlsdGVyPElDb25maWc+KSA9PiBwbHVnaW4uZmlsdGVyX21ldGFkYXRhXG4gICk7XG4gIGNvbnN0IHN0b3JhZ2UgPSBuZXcgU3RvcmFnZShjb25maWcpO1xuICAvLyB3YWl0cyB1bnRpbCBpbml0IGNhbGxzIGhhdmUgYmVlbiBpbml0aWFsaXplZFxuICBhd2FpdCBzdG9yYWdlLmluaXQoY29uZmlnLCBmaWx0ZXJzKTtcbiAgcmV0dXJuIGF3YWl0IGRlZmluZUFQSShjb25maWcsIHN0b3JhZ2UpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFBQSxZQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxLQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxRQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBSSxPQUFBLEdBQUFKLE9BQUE7QUFFQSxJQUFBSyxXQUFBLEdBQUFMLE9BQUE7QUFJQSxJQUFBTSxLQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTyxRQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUSxVQUFBLEdBQUFSLE9BQUE7QUFDQSxJQUFBUyxPQUFBLEdBQUFULE9BQUE7QUFDQSxJQUFBVSxhQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVyxRQUFBLEdBQUFaLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBWSxNQUFBLEdBQUFaLE9BQUE7QUFFQSxJQUFBYSxNQUFBLEdBQUFkLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBYyxTQUFBLEdBQUFmLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBZSxZQUFBLEdBQUFmLE9BQUE7QUFDQSxJQUFBZ0IsSUFBQSxHQUFBakIsc0JBQUEsQ0FBQUMsT0FBQTtBQUFrQyxTQUFBRCx1QkFBQWtCLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFFbEMsTUFBTTtFQUFFRztBQUFRLENBQUMsR0FBR3BCLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztBQUUxQyxTQUFTcUIsU0FBU0EsQ0FBQ0MsTUFBTSxF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