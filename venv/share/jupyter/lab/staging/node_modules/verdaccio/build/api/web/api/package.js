"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _express = require("express");
var _lodash = _interopRequireDefault(require("lodash"));
var _middleware = require("@verdaccio/middleware");
var _tarball = require("@verdaccio/tarball");
var _utils = require("@verdaccio/utils");
var _constants = require("../../../lib/constants");
var _logger = require("../../../lib/logger");
var _utils2 = require("../../../lib/utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const getOrder = (order = 'asc') => {
  return order === 'asc';
};
function addPackageWebApi(storage, auth, config) {
  const can = (0, _middleware.allow)(auth, {
    beforeAll: (params, message) => {
      _logger.logger.debug(params, message);
    },
    afterAll: (params, message) => _logger.logger.debug(params, message)
  });
  const pkgRouter = (0, _express.Router)(); /* eslint new-cap: 0 */

  const checkAllow = (name, remoteUser) => new Promise((resolve, reject) => {
    try {
      auth.allow_access({
        packageName: name
      }, remoteUser, (err, allowed) => {
        if (err) {
          resolve(false);
        }
        resolve(allowed);
      });
    } catch (err) {
      reject(err);
    }
  });

  // Get list of all visible package
  pkgRouter.get('/packages', function (req, res, next) {
    storage.getLocalDatabase(async function (err, packages) {
      if (err) {
        throw err;
      }
      async function processPackages(packages = []) {
        const permissions = [];
        const packgesCopy = packages.slice();
        for (const pkg of packgesCopy) {
          const pkgCopy = _objectSpread({}, pkg);
          pkgCopy.author = (0, _utils2.formatAuthor)(pkg.author);
          try {
            if (await checkAllow(pkg.name, req.remote_user)) {
              if (config.web) {
                pkgCopy.author.avatar = (0, _utils.generateGravatarUrl)(pkgCopy.author.email, config.web.gravatar);
              }
              if (!_lodash.default.isNil(pkgCopy.dist) && !_lodash.default.isNull(pkgCopy.dist.tarball)) {
                pkgCopy.dist.tarball = (0, _tarball.getLocalRegistryTarballUri)(pkgCopy.dist.tarball, pkg.name, {
                  protocol: req.protocol,
                  headers: req.headers,
                  host: req.hostname
                }, config.url_prefix);
              }
              permissions.push(pkgCopy);
            }
          } catch (err) {
            _logger.logger.error({
              name: pkg.name,
              error: err
            }, 'permission process for @{name} has failed: @{error}');
            throw err;
          }
        }
        return permissions;
      }
      const {
        web
      } = config;
      // @ts-ignore
      const order = config.web ? getOrder(web.sort_packages) : true;
      try {
        next((0, _utils2.sortByName)(await processPackages(packages), order));
      } catch (error) {
        next(_utils2.ErrorCode.getInternalError());
      }
    });
  });

  // Get package readme
  pkgRouter.get('/package/readme/(@:scope/)?:package/:version?', can('access'), function (req, res, next) {
    const packageName = req.params.scope ? (0, _utils2.addScope)(req.params.scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      req,
      callback: function (err, info) {
        if (err) {
          return next(err);
        }
        res.set(_constants.HEADER_TYPE.CONTENT_TYPE, _constants.HEADERS.TEXT_PLAIN);
        next((0, _utils2.parseReadme)(info.name, info.readme));
      }
    });
  });
  pkgRouter.get('/sidebar/(@:scope/)?:package', can('access'), function (req, res, next) {
    const packageName = req.params.scope ? (0, _utils2.addScope)(req.params.scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      keepUpLinkData: true,
      req,
      callback: function (err, info) {
        if (_lodash.default.isNil(err)) {
          const {
            v
          } = req.query;
          let sideBarInfo = _lodash.default.clone(info);
          sideBarInfo.versions = (0, _tarball.convertDistRemoteToLocalTarballUrls)(info, {
            protocol: req.protocol,
            headers: req.headers,
            host: req.hostname
          }, config.url_prefix).versions;
          if ((0, _utils2.isVersionValid)(info, v)) {
            // @ts-ignore
            sideBarInfo.latest = sideBarInfo.versions[v];
            sideBarInfo.latest.author = (0, _utils2.formatAuthor)(sideBarInfo.latest.author);
          } else {
            var _sideBarInfo;
            sideBarInfo.latest = sideBarInfo.versions[info[_constants.DIST_TAGS].latest];
            if ((_sideBarInfo = sideBarInfo) !== null && _sideBarInfo !== void 0 && _sideBarInfo.latest) {
              sideBarInfo.latest.author = (0, _utils2.formatAuthor)(sideBarInfo.latest.author);
            } else {
              res.status(_constants.HTTP_STATUS.NOT_FOUND);
              res.end();
              return;
            }
          }
          sideBarInfo = (0, _utils2.deleteProperties)(['readme', '_attachments', '_rev', 'name'], sideBarInfo);
          if (config.web) {
            sideBarInfo = (0, _utils2.addGravatarSupport)(sideBarInfo, config.web.gravatar);
          } else {
            sideBarInfo = (0, _utils2.addGravatarSupport)(sideBarInfo);
          }
          next(sideBarInfo);
        } else {
          res.status(_constants.HTTP_STATUS.NOT_FOUND);
          res.end();
        }
      }
    });
  });
  return pkgRouter;
}
var _default = addPackageWebApi;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9taWRkbGV3YXJlIiwiX3RhcmJhbGwiLCJfdXRpbHMiLCJfY29uc3RhbnRzIiwiX2xvZ2dlciIsIl91dGlsczIiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIm93bktleXMiLCJvYmplY3QiLCJlbnVtZXJhYmxlT25seSIsImtleXMiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJzeW1ib2xzIiwiZmlsdGVyIiwic3ltIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwiZm9yRWFjaCIsImtleSIsIl9kZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJhcmciLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJpbnB1dCIsImhpbnQiLCJwcmltIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJ1bmRlZmluZWQiLCJyZXMiLCJjYWxsIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiZ2V0T3JkZXIiLCJvcmRlciIsImFkZFBhY2thZ2VXZWJBcGkiLCJzdG9yYWdlIiwiYXV0aCIsImNvbmZpZyIsImNhbiIsImFsbG93IiwiYmVmb3JlQWxsIiwicGFyYW1zIiwibWVzc2FnZSIsImxvZ2dlciIsImRlYnVnIiwiYWZ0ZXJBbGwiLCJwa2dSb3V0ZXIiLCJSb3V0ZXIiLCJjaGVja0FsbG93IiwibmFtZSIsInJlbW90ZVVzZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImFsbG93X2FjY2VzcyIsInBhY2thZ2VOYW1lIiwiZXJyIiwiYWxsb3dlZCIsImdldCIsInJlcSIsIm5leHQiLCJnZXRMb2NhbERhdGFiYXNlIiwicGFja2FnZXMiLCJwcm9jZXNzUGFja2FnZXMiLCJwZXJtaXNzaW9ucyIsInBhY2tnZXNDb3B5Iiwic2xpY2UiLCJwa2ciLCJwa2dDb3B5IiwiYXV0aG9yIiwiZm9ybWF0QXV0aG9yIiwicmVtb3RlX3VzZXIiLCJ3ZWIiLCJhdmF0YXIiLCJnZW5lcmF0ZUdyYXZhdGFyVXJsIiwiZW1haWwiLCJncmF2YXRhciIsIl8iLCJpc05pbCIsImRpc3QiLCJpc051bGwiLCJ0YXJiYWxsIiwiZ2V0TG9jYWxSZWdpc3RyeVRhcmJhbGxVcmkiLCJwcm90b2NvbCIsImhlYWRlcnMiLCJob3N0IiwiaG9zdG5hbWUiLCJ1cmxfcHJlZml4IiwiZXJyb3IiLCJzb3J0X3BhY2thZ2VzIiwic29ydEJ5TmFtZSIsIkVycm9yQ29kZSIsImdldEludGVybmFsRXJyb3IiLCJzY29wZSIsImFkZFNjb3BlIiwicGFja2FnZSIsImdldFBhY2thZ2UiLCJ1cGxpbmtzTG9vayIsImNhbGxiYWNrIiwiaW5mbyIsInNldCIsIkhFQURFUl9UWVBFIiwiQ09OVEVOVF9UWVBFIiwiSEVBREVSUyIsIlRFWFRfUExBSU4iLCJwYXJzZVJlYWRtZSIsInJlYWRtZSIsImtlZXBVcExpbmtEYXRhIiwidiIsInF1ZXJ5Iiwic2lkZUJhckluZm8iLCJjbG9uZSIsInZlcnNpb25zIiwiY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMiLCJpc1ZlcnNpb25WYWxpZCIsImxhdGVzdCIsIl9zaWRlQmFySW5mbyIsIkRJU1RfVEFHUyIsInN0YXR1cyIsIkhUVFBfU1RBVFVTIiwiTk9UX0ZPVU5EIiwiZW5kIiwiZGVsZXRlUHJvcGVydGllcyIsImFkZEdyYXZhdGFyU3VwcG9ydCIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGkvd2ViL2FwaS9wYWNrYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgYWxsb3cgfSBmcm9tICdAdmVyZGFjY2lvL21pZGRsZXdhcmUnO1xuaW1wb3J0IHtcbiAgY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMsXG4gIGdldExvY2FsUmVnaXN0cnlUYXJiYWxsVXJpLFxufSBmcm9tICdAdmVyZGFjY2lvL3RhcmJhbGwnO1xuaW1wb3J0IHsgQ29uZmlnLCBQYWNrYWdlIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQgeyBnZW5lcmF0ZUdyYXZhdGFyVXJsIH0gZnJvbSAnQHZlcmRhY2Npby91dGlscyc7XG5cbmltcG9ydCBBdXRoIGZyb20gJy4uLy4uLy4uL2xpYi9hdXRoJztcbmltcG9ydCB7IERJU1RfVEFHUywgSEVBREVSUywgSEVBREVSX1RZUEUsIEhUVFBfU1RBVFVTIH0gZnJvbSAnLi4vLi4vLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi8uLi9saWIvbG9nZ2VyJztcbmltcG9ydCBTdG9yYWdlIGZyb20gJy4uLy4uLy4uL2xpYi9zdG9yYWdlJztcbmltcG9ydCB7XG4gIEVycm9yQ29kZSxcbiAgYWRkR3JhdmF0YXJTdXBwb3J0LFxuICBhZGRTY29wZSxcbiAgZGVsZXRlUHJvcGVydGllcyxcbiAgZm9ybWF0QXV0aG9yLFxuICBpc1ZlcnNpb25WYWxpZCxcbiAgcGFyc2VSZWFkbWUsXG4gIHNvcnRCeU5hbWUsXG59IGZyb20gJy4uLy4uLy4uL2xpYi91dGlscyc7XG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCAkU2lkZWJhclBhY2thZ2UgfSBmcm9tICcuLi8uLi8uLi90eXBlcyc7XG5cbmNvbnN0IGdldE9yZGVyID0gKG9yZGVyID0gJ2FzYycpID0+IHtcbiAgcmV0dXJuIG9yZGVyID09PSAnYXNjJztcbn07XG5cbmV4cG9ydCB0eXBlIFBhY2tjYWdlRXh0ID0gUGFja2FnZSAmIHsgYXV0aG9yOiBhbnk7IGRpc3Q/OiB7IHRhcmJhbGw6IHN0cmluZyB9IH07XG5cbmZ1bmN0aW9uIGFkZFBhY2thZ2VXZWJBcGkoc3RvcmFnZTogU3RvcmFnZSwgYXV0aDogQXV0aCwgY29uZmlnOiBDb25maWcpOiBSb3V0ZXIge1xuICBjb25zdCBjYW4gPSBhbGxvdyhhdXRoLCB7XG4gICAgYmVmb3JlQWxsOiAocGFyYW1zLCBtZXNzYWdlKSA9PiB7XG4gICAgICBsb2dnZXIuZGVidWcocGFyYW1zLCBtZXNzYWdlKTtcbiAgICB9LFxuICAgIGFmdGVyQWxsOiAocGFyYW1zLCBtZXNzYWdlKSA9PiBsb2dnZXIuZGVidWcocGFyYW1zLCBtZXNzYWdlKSxcbiAgfSk7XG4gIGNvbnN0IHBrZ1JvdXRlciA9IFJvdXRlcigpOyAvKiBlc2xpbnQgbmV3LWNhcDogMCAqL1xuXG4gIGNvbnN0IGNoZWNrQWxsb3cgPSAobmFtZSwgcmVtb3RlVXNlcik6IFByb21pc2U8Ym9vbGVhbj4gPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KTogdm9pZCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhdXRoLmFsbG93X2FjY2Vzcyh7IHBhY2thZ2VOYW1lOiBuYW1lIH0sIHJlbW90ZVVzZXIsIChlcnIsIGFsbG93ZWQpOiB2b2lkID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzb2x2ZShhbGxvd2VkKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgLy8gR2V0IGxpc3Qgb2YgYWxsIHZpc2libGUgcGFja2FnZVxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgICcvcGFja2FnZXMnLFxuICAgIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgc3RvcmFnZS5nZXRMb2NhbERhdGFiYXNlKGFzeW5jIGZ1bmN0aW9uIChlcnIsIHBhY2thZ2VzKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzUGFja2FnZXMocGFja2FnZXM6IFBhY2tjYWdlRXh0W10gPSBbXSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgICAgY29uc3QgcGVybWlzc2lvbnM6IFBhY2tjYWdlRXh0W10gPSBbXTtcbiAgICAgICAgICBjb25zdCBwYWNrZ2VzQ29weSA9IHBhY2thZ2VzLnNsaWNlKCk7XG4gICAgICAgICAgZm9yIChjb25zdCBwa2cgb2YgcGFja2dlc0NvcHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHBrZ0NvcHkgPSB7IC4uLnBrZyB9O1xuICAgICAgICAgICAgcGtnQ29weS5hdXRob3IgPSBmb3JtYXRBdXRob3IocGtnLmF1dGhvcik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpZiAoYXdhaXQgY2hlY2tBbGxvdyhwa2cubmFtZSwgcmVxLnJlbW90ZV91c2VyKSkge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcud2ViKSB7XG4gICAgICAgICAgICAgICAgICBwa2dDb3B5LmF1dGhvci5hdmF0YXIgPSBnZW5lcmF0ZUdyYXZhdGFyVXJsKFxuICAgICAgICAgICAgICAgICAgICBwa2dDb3B5LmF1dGhvci5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLndlYi5ncmF2YXRhclxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFfLmlzTmlsKHBrZ0NvcHkuZGlzdCkgJiYgIV8uaXNOdWxsKHBrZ0NvcHkuZGlzdC50YXJiYWxsKSkge1xuICAgICAgICAgICAgICAgICAgcGtnQ29weS5kaXN0LnRhcmJhbGwgPSBnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaShcbiAgICAgICAgICAgICAgICAgICAgcGtnQ29weS5kaXN0LnRhcmJhbGwsXG4gICAgICAgICAgICAgICAgICAgIHBrZy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB7IHByb3RvY29sOiByZXEucHJvdG9jb2wsIGhlYWRlcnM6IHJlcS5oZWFkZXJzIGFzIGFueSwgaG9zdDogcmVxLmhvc3RuYW1lIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy51cmxfcHJlZml4XG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucy5wdXNoKHBrZ0NvcHkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICAgIHsgbmFtZTogcGtnLm5hbWUsIGVycm9yOiBlcnIgfSxcbiAgICAgICAgICAgICAgICAncGVybWlzc2lvbiBwcm9jZXNzIGZvciBAe25hbWV9IGhhcyBmYWlsZWQ6IEB7ZXJyb3J9J1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB3ZWIgfSA9IGNvbmZpZztcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBvcmRlcjogYm9vbGVhbiA9IGNvbmZpZy53ZWIgPyBnZXRPcmRlcih3ZWIuc29ydF9wYWNrYWdlcykgOiB0cnVlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbmV4dChzb3J0QnlOYW1lKGF3YWl0IHByb2Nlc3NQYWNrYWdlcyhwYWNrYWdlcyksIG9yZGVyKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbmV4dChFcnJvckNvZGUuZ2V0SW50ZXJuYWxFcnJvcigpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIC8vIEdldCBwYWNrYWdlIHJlYWRtZVxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgICcvcGFja2FnZS9yZWFkbWUvKEA6c2NvcGUvKT86cGFja2FnZS86dmVyc2lvbj8nLFxuICAgIGNhbignYWNjZXNzJyksXG4gICAgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICBjb25zdCBwYWNrYWdlTmFtZSA9IHJlcS5wYXJhbXMuc2NvcGVcbiAgICAgICAgPyBhZGRTY29wZShyZXEucGFyYW1zLnNjb3BlLCByZXEucGFyYW1zLnBhY2thZ2UpXG4gICAgICAgIDogcmVxLnBhcmFtcy5wYWNrYWdlO1xuXG4gICAgICBzdG9yYWdlLmdldFBhY2thZ2Uoe1xuICAgICAgICBuYW1lOiBwYWNrYWdlTmFtZSxcbiAgICAgICAgdXBsaW5rc0xvb2s6IHRydWUsXG4gICAgICAgIHJlcSxcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChlcnIsIGluZm8pOiB2b2lkIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dChlcnIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcy5zZXQoSEVBREVSX1RZUEUuQ09OVEVOVF9UWVBFLCBIRUFERVJTLlRFWFRfUExBSU4pO1xuICAgICAgICAgIG5leHQocGFyc2VSZWFkbWUoaW5mby5uYW1lLCBpbmZvLnJlYWRtZSkpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIHBrZ1JvdXRlci5nZXQoXG4gICAgJy9zaWRlYmFyLyhAOnNjb3BlLyk/OnBhY2thZ2UnLFxuICAgIGNhbignYWNjZXNzJyksXG4gICAgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICBjb25zdCBwYWNrYWdlTmFtZTogc3RyaW5nID0gcmVxLnBhcmFtcy5zY29wZVxuICAgICAgICA/IGFkZFNjb3BlKHJlcS5wYXJhbXMuc2NvcGUsIHJlcS5wYXJhbXMucGFja2FnZSlcbiAgICAgICAgOiByZXEucGFyYW1zLnBhY2thZ2U7XG5cbiAgICAgIHN0b3JhZ2UuZ2V0UGFja2FnZSh7XG4gICAgICAgIG5hbWU6IHBhY2thZ2VOYW1lLFxuICAgICAgICB1cGxpbmtzTG9vazogdHJ1ZSxcbiAgICAgICAga2VlcFVwTGlua0RhdGE6IHRydWUsXG4gICAgICAgIHJlcSxcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChlcnI6IEVycm9yLCBpbmZvOiAkU2lkZWJhclBhY2thZ2UpOiB2b2lkIHtcbiAgICAgICAgICBpZiAoXy5pc05pbChlcnIpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHYgfSA9IHJlcS5xdWVyeTtcbiAgICAgICAgICAgIGxldCBzaWRlQmFySW5mbzogYW55ID0gXy5jbG9uZShpbmZvKTtcbiAgICAgICAgICAgIHNpZGVCYXJJbmZvLnZlcnNpb25zID0gY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMoXG4gICAgICAgICAgICAgIGluZm8sXG4gICAgICAgICAgICAgIHsgcHJvdG9jb2w6IHJlcS5wcm90b2NvbCwgaGVhZGVyczogcmVxLmhlYWRlcnMgYXMgYW55LCBob3N0OiByZXEuaG9zdG5hbWUgfSxcbiAgICAgICAgICAgICAgY29uZmlnLnVybF9wcmVmaXhcbiAgICAgICAgICAgICkudmVyc2lvbnM7XG4gICAgICAgICAgICBpZiAoaXNWZXJzaW9uVmFsaWQoaW5mbywgdikpIHtcbiAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICBzaWRlQmFySW5mby5sYXRlc3QgPSBzaWRlQmFySW5mby52ZXJzaW9uc1t2XTtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvciA9IGZvcm1hdEF1dGhvcihzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdCA9IHNpZGVCYXJJbmZvLnZlcnNpb25zW2luZm9bRElTVF9UQUdTXS5sYXRlc3RdO1xuICAgICAgICAgICAgICBpZiAoc2lkZUJhckluZm8/LmxhdGVzdCkge1xuICAgICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdC5hdXRob3IgPSBmb3JtYXRBdXRob3Ioc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvcik7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpO1xuICAgICAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gZGVsZXRlUHJvcGVydGllcyhbJ3JlYWRtZScsICdfYXR0YWNobWVudHMnLCAnX3JldicsICduYW1lJ10sIHNpZGVCYXJJbmZvKTtcbiAgICAgICAgICAgIGlmIChjb25maWcud2ViKSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gYWRkR3JhdmF0YXJTdXBwb3J0KHNpZGVCYXJJbmZvLCBjb25maWcud2ViLmdyYXZhdGFyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvID0gYWRkR3JhdmF0YXJTdXBwb3J0KHNpZGVCYXJJbmZvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5leHQoc2lkZUJhckluZm8pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCk7XG4gICAgICAgICAgICByZXMuZW5kKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIHJldHVybiBwa2dSb3V0ZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFkZFBhY2thZ2VXZWJBcGk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFFBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUVBLElBQUFHLFdBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLFFBQUEsR0FBQUosT0FBQTtBQUtBLElBQUFLLE1BQUEsR0FBQUwsT0FBQTtBQUdBLElBQUFNLFVBQUEsR0FBQU4sT0FBQTtBQUNBLElBQUFPLE9BQUEsR0FBQVAsT0FBQTtBQUVBLElBQUFRLE9BQUEsR0FBQVIsT0FBQTtBQVM0QixTQUFBRSx1QkFBQU8sR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9BQUEsRUFBQUYsR0FBQTtBQUFBLFNBQUFHLFFBQUFDLE1BQUEsRUFBQUMsY0FBQSxRQUFBQyxJQUFBLEdBQUFDLE1BQUEsQ0FBQUQsSUFBQSxDQUFBRixNQUFBLE9BQUFHLE1BQUEsQ0FBQUMscUJBQUEsUUFBQUMsT0FBQSxHQUFBRixNQUFBLENBQUFDLHFCQUFBLENBQUFKLE1BQUEsR0FBQUMsY0FBQSxLQUFBSSxPQUFBLEdBQUFBLE9BQUEsQ0FBQUMsTUFBQSxXQUFBQyxHQUFBLFdBQUFKLE1BQUEsQ0FBQUssd0JBQUEsQ0FBQVIsTUFBQSxFQUFBTyxHQUFBLEVBQUFFLFVBQUEsT0FBQVAsSUFBQSxDQUFBUSxJQUFBLENBQUFDLEtBQUEsQ0FBQVQsSUFBQSxFQUFBRyxPQUFBLFlBQUFILElBQUE7QUFBQSxTQUFBVSxjQUFBQyxNQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBQyxTQUFBLENB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