!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.vega)}(this,(function(e,t,n){"use strict";function r(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function i(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function u(){return 0}class o extends Set{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const t of e)this.add(t)}has(e){return super.has(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):t}(this,e))}add(e){return super.add(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):(n.set(i,t),t)}(this,e))}delete(e){return super.delete(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);n.has(i)&&(t=n.get(i),n.delete(i));return t}(this,e))}}function l(e){return null!==e&&"object"==typeof e?e.valueOf():e}function f(e){return e instanceof o?e:new o(e)}const s="intersect",a="union",c="vlMulti",d="vlPoint",h="or",g="and",v="_vgsid_",p=t.field(v),y="E",m="R",_="R-E",b="R-LE",N="R-RE",x="index:unit";function O(e,n){for(var r,i,u=n.fields,o=n.values,l=u.length,f=0;f<l;++f)if((i=u[f]).getter=t.field.getter||t.field(i.field),r=i.getter(e),t.isDate(r)&&(r=t.toNumber(r)),t.isDate(o[f])&&(o[f]=t.toNumber(o[f])),t.isDate(o[f][0])&&(o[f]=o[f].map(t.toNumber)),i.type===y){if(t.isArray(o[f])?o[f].indexOf(r)<0:r!==o[f])return!1}else if(i.type===m){if(!t.inrange(r,o[f]))return!1}else if(i.type===N){if(!t.inrange(r,o[f],!0,!1))return!1}else if(i.type===_){if(!t.inrange(r,o[f],!1,!1))return!1}else if(i.type===b&&!t.inrange(r,o[f],!1,!0))return!1;return!0}const w=function(e){let t,n,o;function l(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<u){if(0!==t(r,r))return u;do{const t=i+u>>>1;n(e[t],r)<0?i=t+1:u=t}while(i<u)}return i}return 2!==e.length?(t=r,n=(t,n)=>r(e(t),n),o=(t,n)=>e(t)-n):(t=e===r||e===i?e:u,n=e,o=e),{left:l,center:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=l(e,t,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return r>n&&o(e[r-1],t)>-o(e[r],t)?r-1:r},right:function(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<u){if(0!==t(r,r))return u;do{const t=i+u>>>1;n(e[t],r)<=0?i=t+1:u=t}while(i<u)}return i}}}(p),R=w.left,k=w.right;var j={[`${v}_union`]:function(){const e=new o;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const t of n)for(const n of t)e.add(n);return e},[`${v}_intersect`]:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=new o(e),n=n.map(f);e:for(const t of e)for(const r of n)if(!r.has(t)){e.delete(t);continue e}return e},E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?(e[0]>r&&(e[0]=r),e[1]<i&&(e[1]=i),e):[r,i]},R_intersect:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?i<e[0]||e[1]<r?[]:(e[0]<r&&(e[0]=r),e[1]>i&&(e[1]=i),e):[r,i]}};const E=":",$="@";e.selectionIdTest=function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[x]&&r[x].value:void 0,o=n===s,l=p(t),f=R(i,l);if(f===i.length)return!1;if(p(i[f])!==l)return!1;if(u&&o){if(1===u.size)return!0;if(k(i,l)-f<u.size)return!1}return!0},e.selectionResolve=function(e,n,r,i){for(var u,o,l,f,s,y,m,_,b,N,x,O,w=this.context.data[e],R=w?w.values.value:[],k={},E={},$={},D=R.length,T=0;T<D;++T)if(f=(u=R[T]).unit,o=u.fields,l=u.values,o&&l){for(x=0,O=o.length;x<O;++x)s=o[x],_=(m=k[s.field]||(k[s.field]={}))[f]||(m[f]=[]),$[s.field]=b=s.type.charAt(0),N=j[`${b}_union`],m[f]=N(_,t.array(l[x]));r&&(_=E[f]||(E[f]=[])).push(t.array(l).reduce(((e,t,n)=>(e[o[n].field]=t,e)),{}))}else s=v,y=p(u),(_=(m=k[s]||(k[s]={}))[f]||(m[f]=[])).push(y),r&&(_=E[f]||(E[f]=[])).push({[v]:y});if(n=n||a,k[v]?k[v]=j[`${v}_${n}`](...Object.values(k[v])):Object.keys(k).forEach((e=>{k[e]=Object.keys(k[e]).map((t=>k[e][t])).reduce(((t,r)=>void 0===t?r:j[`${$[e]}_${n}`](t,r)))})),R=Object.keys(E),r&&R.length){k[i?d:c]=n===a?{[h]:R.reduce(((e,t)=>(e.push(...E[t]),e)),[])}:{[g]:R.map((e=>({[h]:E[e]})))}}return k},e.selectionTest=function(e,t,n){for(var r,i,u,o,l,f=this.context.data[e],a=f?f.values.value:[],c=f?f[x]&&f[x].value:void 0,d=n===s,h=a.length,g=0;g<h;++g)if(r=a[g],c&&d){if(-1===(u=(i=i||{})[o=r.unit]||0))continue;if(l=O(t,r),i[o]=l?-1:++u,l&&1===c.size)return!0;if(!l&&u===c.get(o).count)return!1}else if(d^(l=O(t,r)))return l;return h&&d},e.selectionTuples=function(e,n){return e.map((e=>t.extend(n.fields?{values:n.fields.map((n=>(n.getter||(n.getter=t.field(n.field)))(e.datum)))}:{[v]:p(e.datum)},n)))},e.selectionVisitor=function(e,r,i,u){r[0].type!==n.Literal&&t.error("First argument to selection functions must be a string literal.");const o=r[0].value,l=r.length>=2&&t.peek(r).value,f="unit",a=$+f,c=E+o;l!==s||t.hasOwnProperty(u,a)||(u[a]=i.getData(o).indataRef(i,f)),t.hasOwnProperty(u,c)||(u[c]=i.getData(o).tuplesRef())}}));
//# sourceMappingURL=vega-selection.min.js.map
