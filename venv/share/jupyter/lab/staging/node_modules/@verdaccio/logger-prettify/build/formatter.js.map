{"version":3,"file":"formatter.js","names":["_colorette","require","_util","_levels","_utils","LEVEL_VALUE_MAX","l","levelsColors","Math","max","length","ERROR_FLAG","fillInMsgTemplate","msg","templateOptions","colors","templateRegex","replace","_","name","str","isError","slice","listAccessors","split","property","id","isObject","includes","red","green","inspect","undefined","getMessage","debugLevel","sub","templateObjects","hasColors","finalMessage","subSystemType","subSystemLevels","color","white","logString","padRight","padLeft","printMessage","options","prettyStamp","level","calculateLevel","logMessage","formatLoggingDate","time"],"sources":["../src/formatter.ts"],"sourcesContent":["import { green, red, white } from 'colorette';\nimport { inspect } from 'util';\n\nimport { LevelCode, calculateLevel, levelsColors, subSystemLevels } from './levels';\nimport { PrettyOptionsExtended } from './types';\nimport { formatLoggingDate, isObject, padLeft, padRight } from './utils';\n\nlet LEVEL_VALUE_MAX = 0;\nfor (const l in levelsColors) {\n  LEVEL_VALUE_MAX = Math.max(LEVEL_VALUE_MAX, l.length);\n}\n\nconst ERROR_FLAG = '!';\n\nexport interface ObjectTemplate {\n  level: LevelCode;\n  msg: string;\n  sub?: string;\n  [key: string]: string | number | object | null | void;\n}\n\nexport function fillInMsgTemplate(\n  msg: string,\n  templateOptions: ObjectTemplate,\n  colors: boolean\n): string {\n  const templateRegex = /@{(!?[$A-Za-z_][$0-9A-Za-z\\._]*)}/g;\n\n  return msg.replace(templateRegex, (_, name): string => {\n    let str = templateOptions;\n    let isError;\n    if (name[0] === ERROR_FLAG) {\n      name = name.slice(1);\n      isError = true;\n    }\n\n    // object can be @{foo.bar.}\n    const listAccessors = name.split('.');\n    for (let property = 0; property < listAccessors.length; property++) {\n      const id = listAccessors[property];\n      if (isObject(str)) {\n        str = (str as object)[id];\n      }\n    }\n\n    if (typeof str === 'string') {\n      if (colors === false || (str as string).includes('\\n')) {\n        return str;\n      } else if (isError) {\n        return red(str);\n      }\n      return green(str);\n    }\n\n    // object, showHidden, depth, colors\n    return inspect(str, undefined, null, colors);\n  });\n}\n\nfunction getMessage(debugLevel, msg, sub, templateObjects, hasColors: boolean) {\n  const finalMessage = fillInMsgTemplate(msg, templateObjects, hasColors);\n\n  const subSystemType = hasColors\n    ? subSystemLevels.color[sub ?? 'default']\n    : subSystemLevels.white[sub ?? 'default'];\n  if (hasColors) {\n    const logString = `${levelsColors[debugLevel](padRight(debugLevel, LEVEL_VALUE_MAX))}${white(\n      `${subSystemType} ${finalMessage}`\n    )}`;\n\n    return padLeft(logString);\n  }\n  const logString = `${padRight(debugLevel, LEVEL_VALUE_MAX)}${subSystemType} ${finalMessage}`;\n\n  return padRight(logString);\n}\n\nexport function printMessage(\n  templateObjects: ObjectTemplate,\n  options: Pick<PrettyOptionsExtended, 'prettyStamp'>,\n  hasColors: boolean\n): string {\n  const { prettyStamp } = options;\n  const { level, msg, sub } = templateObjects;\n  const debugLevel = calculateLevel(level);\n  const logMessage = getMessage(debugLevel, msg, sub, templateObjects, hasColors);\n\n  return prettyStamp ? formatLoggingDate(templateObjects.time as number, logMessage) : logMessage;\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AAEA,IAAAE,OAAA,GAAAF,OAAA;AAEA,IAAAG,MAAA,GAAAH,OAAA;AAEA,IAAII,eAAe,GAAG,CAAC;AACvB,KAAK,MAAMC,CAAC,IAAIC,oBAAY,EAAE;EAC5BF,eAAe,GAAGG,IAAI,CAACC,GAAG,CAACJ,eAAe,EAAEC,CAAC,CAACI,MAAM,CAAC;AACvD;AAEA,MAAMC,UAAU,GAAG,GAAG;AASf,SAASC,iBAAiBA,CAC/BC,GAAW,EACXC,eAA+B,EAC/BC,MAAe,EACP;EACR,MAAMC,aAAa,GAAG,oCAAoC;EAE1D,OAAOH,GAAG,CAACI,OAAO,CAACD,aAAa,EAAE,CAACE,CAAC,EAAEC,IAAI,KAAa;IACrD,IAAIC,GAAG,GAAGN,eAAe;IACzB,IAAIO,OAAO;IACX,IAAIF,IAAI,CAAC,CAAC,CAAC,KAAKR,UAAU,EAAE;MAC1BQ,IAAI,GAAGA,IAAI,CAACG,KAAK,CAAC,CAAC,CAAC;MACpBD,OAAO,GAAG,IAAI;IAChB;;IAEA;IACA,MAAME,aAAa,GAAGJ,IAAI,CAACK,KAAK,CAAC,GAAG,CAAC;IACrC,KAAK,IAAIC,QAAQ,GAAG,CAAC,EAAEA,QAAQ,GAAGF,aAAa,CAACb,MAAM,EAAEe,QAAQ,EAAE,EAAE;MAClE,MAAMC,EAAE,GAAGH,aAAa,CAACE,QAAQ,CAAC;MAClC,IAAI,IAAAE,eAAQ,EAACP,GAAG,CAAC,EAAE;QACjBA,GAAG,GAAIA,GAAG,CAAYM,EAAE,CAAC;MAC3B;IACF;IAEA,IAAI,OAAON,GAAG,KAAK,QAAQ,EAAE;MAC3B,IAAIL,MAAM,KAAK,KAAK,IAAKK,GAAG,CAAYQ,QAAQ,CAAC,IAAI,CAAC,EAAE;QACtD,OAAOR,GAAG;MACZ,CAAC,MAAM,IAAIC,OAAO,EAAE;QAClB,OAAO,IAAAQ,cAAG,EAACT,GAAG,CAAC;MACjB;MACA,OAAO,IAAAU,gBAAK,EAACV,GAAG,CAAC;IACnB;;IAEA;IACA,OAAO,IAAAW,aAAO,EAACX,GAAG,EAAEY,SAAS,EAAE,IAAI,EAAEjB,MAAM,CAAC;EAC9C,CAAC,CAAC;AACJ;AAEA,SAASkB,UAAUA,CAACC,UAAU,EAAErB,GAAG,EAAEsB,GAAG,EAAEC,eAAe,EAAEC,SAAkB,EAAE;EAC7E,MAAMC,YAAY,GAAG1B,iBAAiB,CAACC,GAAG,EAAEuB,eAAe,EAAEC,SAAS,CAAC;EAEvE,MAAME,aAAa,GAAGF,SAAS,GAC3BG,uBAAe,CAACC,KAAK,CAACN,GAAG,aAAHA,GAAG,cAAHA,GAAG,GAAI,SAAS,CAAC,GACvCK,uBAAe,CAACE,KAAK,CAACP,GAAG,aAAHA,GAAG,cAAHA,GAAG,GAAI,SAAS,CAAC;EAC3C,IAAIE,SAAS,EAAE;IACb,MAAMM,SAAS,GAAI,GAAEpC,oBAAY,CAAC2B,UAAU,CAAC,CAAC,IAAAU,eAAQ,EAACV,UAAU,EAAE7B,eAAe,CAAC,CAAE,GAAE,IAAAqC,gBAAK,EACzF,GAAEH,aAAc,IAAGD,YAAa,EAAC,CAClC,EAAC;IAEH,OAAO,IAAAO,cAAO,EAACF,SAAS,CAAC;EAC3B;EACA,MAAMA,SAAS,GAAI,GAAE,IAAAC,eAAQ,EAACV,UAAU,EAAE7B,eAAe,CAAE,GAAEkC,aAAc,IAAGD,YAAa,EAAC;EAE5F,OAAO,IAAAM,eAAQ,EAACD,SAAS,CAAC;AAC5B;AAEO,SAASG,YAAYA,CAC1BV,eAA+B,EAC/BW,OAAmD,EACnDV,SAAkB,EACV;EACR,MAAM;IAAEW;EAAY,CAAC,GAAGD,OAAO;EAC/B,MAAM;IAAEE,KAAK;IAAEpC,GAAG;IAAEsB;EAAI,CAAC,GAAGC,eAAe;EAC3C,MAAMF,UAAU,GAAG,IAAAgB,sBAAc,EAACD,KAAK,CAAC;EACxC,MAAME,UAAU,GAAGlB,UAAU,CAACC,UAAU,EAAErB,GAAG,EAAEsB,GAAG,EAAEC,eAAe,EAAEC,SAAS,CAAC;EAE/E,OAAOW,WAAW,GAAG,IAAAI,wBAAiB,EAAChB,eAAe,CAACiB,IAAI,EAAYF,UAAU,CAAC,GAAGA,UAAU;AACjG"}