{"version":3,"file":"getLocalRegistryTarballUri.js","names":["_debug","_interopRequireDefault","require","_url","_url2","obj","__esModule","default","debug","buildDebug","extractTarballFromUrl","url","URL","parse","pathname","replace","getLocalRegistryTarballUri","uri","pkgName","requestOptions","urlPrefix","_requestOptions$heade","currentHost","headers","host","tarballName","domainRegistry","getPublicUrl"],"sources":["../src/getLocalRegistryTarballUri.ts"],"sourcesContent":["import buildDebug from 'debug';\nimport URL from 'url';\n\nimport { RequestOptions } from '@verdaccio/url';\nimport { getPublicUrl } from '@verdaccio/url';\n\nconst debug = buildDebug('verdaccio:core:url');\n\nexport function extractTarballFromUrl(url: string): string {\n  // @ts-ignore\n  return URL.parse(url).pathname.replace(/^.*\\//, '');\n}\n/**\n * Filter a tarball url.\n * @param {*} uri\n * @return {String} a parsed url\n */\nexport function getLocalRegistryTarballUri(\n  uri: string,\n  pkgName: string,\n  requestOptions: RequestOptions,\n  urlPrefix: string | void\n): string {\n  const currentHost = requestOptions?.headers?.host;\n\n  if (!currentHost) {\n    return uri;\n  }\n  const tarballName = extractTarballFromUrl(uri);\n  debug('tarball name %o', tarballName);\n  // header only set with proxy that setup with HTTPS\n  const domainRegistry = getPublicUrl(urlPrefix || '', requestOptions);\n\n  return `${domainRegistry}${pkgName}/-/${tarballName}`;\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,IAAA,GAAAF,sBAAA,CAAAC,OAAA;AAGA,IAAAE,KAAA,GAAAF,OAAA;AAA8C,SAAAD,uBAAAI,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAE9C,MAAMG,KAAK,GAAG,IAAAC,cAAU,EAAC,oBAAoB,CAAC;AAEvC,SAASC,qBAAqBA,CAACC,GAAW,EAAU;EACzD;EACA,OAAOC,YAAG,CAACC,KAAK,CAACF,GAAG,CAAC,CAACG,QAAQ,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;AACrD;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,0BAA0BA,CACxCC,GAAW,EACXC,OAAe,EACfC,cAA8B,EAC9BC,SAAwB,EAChB;EAAA,IAAAC,qBAAA;EACR,MAAMC,WAAW,GAAGH,cAAc,aAAdA,cAAc,wBAAAE,qBAAA,GAAdF,cAAc,CAAEI,OAAO,cAAAF,qBAAA,uBAAvBA,qBAAA,CAAyBG,IAAI;EAEjD,IAAI,CAACF,WAAW,EAAE;IAChB,OAAOL,GAAG;EACZ;EACA,MAAMQ,WAAW,GAAGf,qBAAqB,CAACO,GAAG,CAAC;EAC9CT,KAAK,CAAC,iBAAiB,EAAEiB,WAAW,CAAC;EACrC;EACA,MAAMC,cAAc,GAAG,IAAAC,kBAAY,EAACP,SAAS,IAAI,EAAE,EAAED,cAAc,CAAC;EAEpE,OAAQ,GAAEO,cAAe,GAAER,OAAQ,MAAKO,WAAY,EAAC;AACvD"}