{"version":3,"file":"utils.js","names":["_fs","_interopRequireDefault","require","_path","_lodash","obj","__esModule","default","getFileStats","packagePath","Promise","resolve","reject","fs","stat","err","stats","_","isNil","readDirectory","readdir","scopedPackages","hasScope","file","match","findPackages","storagePath","validationHandler","listPackages","scopePath","path","storageDirs","directory","scopeDirectory","scopedDirName","push","name","error"],"sources":["../src/utils.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nimport _ from 'lodash';\n\nexport function getFileStats(packagePath: string): Promise<fs.Stats> {\n  return new Promise((resolve, reject): void => {\n    fs.stat(packagePath, (err, stats) => {\n      if (_.isNil(err) === false) {\n        return reject(err);\n      }\n      resolve(stats);\n    });\n  });\n}\n\nexport function readDirectory(packagePath: string): Promise<string[]> {\n  return new Promise((resolve, reject): void => {\n    fs.readdir(packagePath, (err, scopedPackages) => {\n      if (_.isNil(err) === false) {\n        return reject(err);\n      }\n\n      resolve(scopedPackages);\n    });\n  });\n}\n\nfunction hasScope(file: string): boolean {\n  return file.match(/^@/) !== null;\n}\n\n/* eslint-disable no-async-promise-executor */\nexport async function findPackages(\n  storagePath: string,\n  validationHandler: Function\n): Promise<{ name: string; path: string }[]> {\n  const listPackages: { name: string; path: string }[] = [];\n  return new Promise(async (resolve, reject) => {\n    try {\n      const scopePath = path.resolve(storagePath);\n      const storageDirs = await readDirectory(scopePath);\n      for (const directory of storageDirs) {\n        // we check whether has 2nd level\n        if (hasScope(directory)) {\n          // we read directory multiple\n          const scopeDirectory = path.resolve(storagePath, directory);\n          const scopedPackages = await readDirectory(scopeDirectory);\n          for (const scopedDirName of scopedPackages) {\n            if (validationHandler(scopedDirName)) {\n              // we build the complete scope path\n              const scopePath = path.resolve(storagePath, directory, scopedDirName);\n              // list content of such directory\n              listPackages.push({\n                name: `${directory}/${scopedDirName}`,\n                path: scopePath,\n              });\n            }\n          }\n        } else {\n          // otherwise we read as single level\n          if (validationHandler(directory)) {\n            const scopePath = path.resolve(storagePath, directory);\n            listPackages.push({\n              name: directory,\n              path: scopePath,\n            });\n          }\n        }\n      }\n    } catch (error) {\n      reject(error);\n    }\n\n    resolve(listPackages);\n  });\n}\n/* eslint-enable no-async-promise-executor */\n"],"mappings":"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"}